<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProfitTrack - –£—á–µ—Ç –∑–∞–∫—É–ø–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-primary: #f9fafb;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --text-primary: #111827;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --input-bg: #ffffff;
      --input-border: #d1d5db;
      --shadow: rgba(0,0,0,0.1);
      --gradient-start: #667eea;
      --gradient-end: #764ba2;
    }
    [data-theme="dark"] {
      --bg-primary: #111827;
      --bg-secondary: #1f2937;
      --bg-card: #374151;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --border-color: #4b5563;
      --input-bg: #374151;
      --input-border: #4b5563;
      --shadow: rgba(0,0,0,0.3);
      --gradient-start: #4c51bf;
      --gradient-end: #7c3aed;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); transition: background 0.3s, color 0.3s; }
    
    .landing-hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 80px 24px; text-align: center; }
    .landing-hero h1 { font-size: 48px; margin-bottom: 16px; }
    .landing-hero p { font-size: 20px; opacity: 0.9; max-width: 600px; margin: 0 auto 32px; }
    .landing-stats { display: flex; justify-content: center; gap: 48px; flex-wrap: wrap; margin-top: 48px; }
    .landing-stat { text-align: center; }
    .landing-stat-value { font-size: 36px; font-weight: bold; }
    .landing-stat-label { font-size: 14px; opacity: 0.8; }
    .landing-btn { padding: 16px 32px; background: white; color: #667eea; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; margin: 8px; }
    .landing-btn-outline { background: transparent; color: white; border: 2px solid white; }
    
    .landing-section { padding: 64px 24px; max-width: 1200px; margin: 0 auto; }
    .landing-section h2 { text-align: center; font-size: 32px; margin-bottom: 48px; color: var(--text-primary); }
    .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; }
    .feature-card { background: var(--bg-card); padding: 32px; border-radius: 12px; box-shadow: 0 4px 6px var(--shadow); text-align: center; }
    .feature-icon { font-size: 48px; margin-bottom: 16px; }
    .feature-card h3 { font-size: 20px; margin-bottom: 12px; color: var(--text-primary); }
    .feature-card p { color: var(--text-secondary); line-height: 1.6; }
    
    .screenshots-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    .screenshot-card { background: var(--bg-card); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px var(--shadow); }
    .screenshot-img { width: 100%; height: 200px; background: linear-gradient(135deg, #10b981, #3b82f6); display: flex; align-items: center; justify-content: center; font-size: 64px; }
    .screenshot-content { padding: 20px; }
    .screenshot-content h3 { font-size: 18px; margin-bottom: 8px; color: var(--text-primary); }
    .screenshot-content p { color: var(--text-secondary); font-size: 14px; }
    
    .reviews-section { background: var(--bg-secondary); }
    .reviews-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    .review-card { background: var(--bg-card); padding: 24px; border-radius: 12px; box-shadow: 0 2px 4px var(--shadow); }
    .review-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .review-avatar { width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #10b981, #3b82f6); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: bold; }
    .review-info h4 { color: var(--text-primary); margin-bottom: 4px; }
    .review-stars { color: #fbbf24; }
    .review-text { color: var(--text-secondary); line-height: 1.6; }
    .review-form { background: var(--bg-card); padding: 24px; border-radius: 12px; max-width: 500px; margin: 32px auto 0; }
    .review-form h3 { margin-bottom: 16px; color: var(--text-primary); }
    .star-rating { display: flex; gap: 8px; margin-bottom: 16px; }
    .star-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #d1d5db; }
    .star-btn.active { color: #fbbf24; }
    
    .landing-footer { background: #1f2937; color: white; padding: 48px 24px; text-align: center; }
    
    .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%); padding: 24px; }
    .auth-card { max-width: 420px; width: 100%; background: var(--bg-card); border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden; }
    .auth-header { background: linear-gradient(135deg, #10b981, #3b82f6); padding: 32px; text-align: center; color: white; }
    .auth-header h1 { font-size: 24px; font-weight: bold; margin-bottom: 12px; }
    .auth-form { padding: 32px; }
    .auth-tabs { display: flex; gap: 8px; margin-bottom: 24px; }
    .auth-tab { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; background: var(--bg-primary); color: var(--text-primary); }
    .auth-tab.active { background: #3b82f6; color: white; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 6px; color: var(--text-primary); }
    .form-group label .required { color: #dc2626; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 1px solid var(--input-border); border-radius: 8px; font-size: 14px; background: var(--input-bg); color: var(--text-primary); }
    .password-input-wrapper { position: relative; }
    .password-input-wrapper input { padding-right: 40px; }
    .password-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px; color: var(--text-secondary); padding: 0; }
    .password-toggle:hover { color: var(--text-primary); }
    .auth-error { background: #fee2e2; color: #dc2626; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
    .auth-success { background: #d1fae5; color: #059669; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
    .info-box { background: #dbeafe; color: #1e40af; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
    .auth-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #10b981, #3b82f6); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
    .auth-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .forgot-password { text-align: center; margin-top: 16px; }
    .forgot-password button { background: none; border: none; color: #3b82f6; cursor: pointer; font-size: 14px; }
    .back-to-login { text-align: center; margin-top: 16px; }
    .back-to-login button { background: none; border: none; color: #6b7280; cursor: pointer; font-size: 14px; }
    
    .app-header { background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); box-shadow: 0 1px 2px var(--shadow); position: sticky; top: 0; z-index: 100; }
    .app-header-content { max-width: 1280px; margin: 0 auto; padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
    .header-left { display: flex; align-items: center; gap: 16px; }
    .menu-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-primary); padding: 8px; border-radius: 8px; }
    .logo { display: flex; align-items: center; gap: 12px; }
    .logo-icon { background: linear-gradient(135deg, #10b981, #3b82f6); padding: 8px; border-radius: 8px; font-size: 24px; }
    .logout-btn { padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
    
    .sidebar-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 200; }
    .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 300px; background: var(--bg-secondary); border-right: 1px solid var(--border-color); z-index: 201; padding: 24px; overflow-y: auto; transform: translateX(-100%); transition: transform 0.3s ease; }
    .sidebar.open { transform: translateX(0); }
    .sidebar-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color); }
    .close-sidebar { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary); }
    .sidebar-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; cursor: pointer; color: var(--text-primary); background: none; border: none; width: 100%; text-align: left; font-size: 16px; }
    .sidebar-item:hover { background: var(--bg-primary); }
    .sidebar-divider { height: 1px; background: var(--border-color); margin: 16px 0; }
    .theme-toggle { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; }
    .toggle-switch { position: relative; width: 50px; height: 26px; background: #6b7280; border-radius: 13px; cursor: pointer; }
    .toggle-switch.active { background: #3b82f6; }
    .toggle-switch::after { content: ''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 0.3s; }
    .toggle-switch.active::after { transform: translateX(24px); }
    
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 300; padding: 24px; }
    .modal-content { background: var(--bg-card); border-radius: 16px; padding: 32px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
    .close-modal { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary); }
    .profile-avatar { width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, #10b981, #3b82f6); display: flex; align-items: center; justify-content: center; font-size: 28px; color: white; }
    
    .main-content { max-width: 1280px; margin: 0 auto; padding: 24px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: var(--bg-card); border-radius: 8px; padding: 16px; display: flex; justify-content: space-between; align-items: center; border: 2px solid transparent; }
    .stat-card.purchases { border-color: #a7f3d0; }
    .stat-card.sales { border-color: #bfdbfe; }
    .stat-card.profit { border-color: #a7f3d0; }
    .stat-card.profit.negative { border-color: #fecaca; }
    .stat-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 4px; }
    .stat-value { font-size: 24px; font-weight: bold; }
    .stat-value.purchases { color: #059669; }
    .stat-value.sales { color: #2563eb; }
    .stat-value.profit { color: #059669; }
    .stat-value.profit.negative { color: #dc2626; }
    .stat-icon { padding: 12px; border-radius: 8px; font-size: 24px; }
    .stat-icon.purchases { background: #d1fae5; }
    .stat-icon.sales { background: #dbeafe; }
    .stat-icon.profit { background: #d1fae5; }
    .stat-icon.profit.negative { background: #fee2e2; }
    
    .tabs { display: flex; background: var(--bg-card); border-radius: 8px; box-shadow: 0 1px 3px var(--shadow); margin-bottom: 24px; }
    .tab { flex: 1; padding: 12px 24px; border: none; background: transparent; cursor: pointer; font-weight: 500; color: var(--text-secondary); }
    .tab.active { background: var(--bg-primary); border-bottom: 2px solid #3b82f6; font-weight: 600; color: var(--text-primary); }
    .tab-content { background: var(--bg-card); border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px var(--shadow); }
    
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; }
    .form-card { border-radius: 8px; padding: 20px; background: var(--bg-card); }
    .form-card.purchase { border: 2px solid #10b981; border-left: 6px solid #10b981; }
    .form-card.sale { border: 2px solid #3b82f6; border-left: 6px solid #3b82f6; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btn { padding: 12px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; }
    .btn-primary { background: #059669; color: white; }
    .btn-secondary { background: #2563eb; color: white; }
    .btn:disabled { background: #9ca3af; cursor: not-allowed; }
    .summary-box { background: #d1fae5; padding: 12px; border-radius: 6px; margin-top: 12px; }
    .summary-box.negative { background: #fee2e2; }
    
    .table-container { overflow-x: auto; max-height: 400px; overflow-y: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 8px; text-align: left; border-bottom: 1px solid var(--border-color); color: var(--text-primary); }
    th { position: sticky; top: 0; background: var(--bg-card); }
    .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
    .badge-success { background: #059669; color: white; }
    .badge-danger { background: #dc2626; color: white; }
    .badge-info { background: #d1fae5; color: #059669; }
    .badge-warning { background: #fee2e2; color: #dc2626; }
    .product-img { width: 40px; height: 40px; object-fit: cover; border-radius: 6px; cursor: pointer; }
    .product-placeholder { width: 40px; height: 40px; background: var(--bg-primary); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    .sell-btn { padding: 4px 10px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .delete-btn { background: none; border: none; color: #dc2626; cursor: pointer; font-size: 16px; }
    .edit-btn { padding: 2px 6px; background: #3b82f6; color: white; border: none; border-radius: 3px; font-size: 10px; cursor: pointer; }
    .notes-box { font-size: 11px; color: #8b5cf6; margin-top: 4px; font-style: italic; }
    
    .branch-selector { background: var(--bg-card); border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px var(--shadow); }
    .branch-controls { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .branch-select { padding: 8px 12px; border: 1px solid var(--input-border); border-radius: 6px; font-size: 14px; min-width: 200px; background: var(--input-bg); color: var(--text-primary); }
    .btn-small { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
    
    .loading { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg-primary); text-align: center; }
    .loading-icon { font-size: 48px; margin-bottom: 16px; }
    
    .preview-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 400; padding: 24px; }
    .preview-modal img { max-width: 90%; max-height: 90%; object-fit: contain; border-radius: 8px; }
    .modal-close-btn { position: absolute; top: 16px; right: 16px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const THEME_KEY = 'profittrack_theme';
    const TOKEN_KEY = 'profittrack_token';
    
    const FAKE_REVIEWS = [
      { id: '1', name: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ö.', rating: 5, text: '–û—Ç–ª–∏—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ! –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –∑–Ω–∞—é —Å–≤–æ—é –ø—Ä–∏–±—ã–ª—å.', date: '2024-01-15' },
      { id: '2', name: '–ú–∞—Ä–∏—è –°.', rating: 5, text: '–ü–æ–ª—å–∑—É—é—Å—å —É–∂–µ –ø–æ–ª–≥–æ–¥–∞. –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!', date: '2024-02-03' },
      { id: '3', name: '–î–º–∏—Ç—Ä–∏–π –í.', rating: 4, text: '–•–æ—Ä–æ—à–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.', date: '2024-02-20' },
      { id: '4', name: '–ï–ª–µ–Ω–∞ –ü.', rating: 5, text: '–°–∞–º–æ–µ —É–¥–æ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á–µ—Ç–∞!', date: '2024-03-08' },
      { id: '5', name: '–ò–≥–æ—Ä—å –ú.', rating: 5, text: '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - —ç—Ç–æ —Ç–æ, —á—Ç–æ –º–Ω–µ –±—ã–ª–æ –Ω—É–∂–Ω–æ!', date: '2024-03-25' },
      { id: '6', name: '–ê–Ω–Ω–∞ –õ.', rating: 4, text: '–£–¥–æ–±–Ω–æ –≤–µ—Å—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ç–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.', date: '2024-04-12' },
    ];

    // Translations
    const translations = {
      ru: {
        // Landing
        appName: 'ProfitTrack',
        tagline: '–£–º–Ω—ã–π —É—á–µ—Ç –∑–∞–∫—É–ø–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂ –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–∏–±—ã–ª—å, —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –∑–∞–ø–∞—Å–∞–º–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–¥–∞–∂–∏.',
        startFree: '–ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ',
        login: '–í–æ–π—Ç–∏',
        users: '–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
        reviews: '–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤',
        salesTracked: '–æ—Ç—Å–ª–µ–∂–µ–Ω–æ –ø—Ä–æ–¥–∞–∂',
        features: '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è',
        autoProfit: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏',
        autoProfitDesc: '–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç –≤–∞—à—É –ø—Ä–∏–±—ã–ª—å –ø–æ –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–µ',
        photos: '–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤',
        photosDesc: '–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫ –∑–∞–∫—É–ø–∫–∞–º - –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ',
        notes: '–ó–∞–º–µ—Ç–∫–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è',
        notesDesc: '–í–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –∫ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ: –∫–æ–Ω—Ç–∞–∫—Ç—ã, —É—Å–ª–æ–≤–∏—è, –º–µ—Å—Ç–æ –ø—Ä–æ–¥–∞–∂–∏',
        categories: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤',
        categoriesDesc: '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤',
        inventory: '–£—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤',
        inventoryDesc: '–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏',
        monthlySummary: '–ú–µ—Å—è—á–Ω–∞—è —Å–≤–æ–¥–∫–∞',
        monthlySummaryDesc: '–ü–æ–ª—É—á–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–æ–≤–∞—Ä—É –∑–∞ –º–µ—Å—è—Ü',
        howItWorks: '–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç',
        step1: '–î–æ–±–∞–≤—å—Ç–µ –∑–∞–∫—É–ø–∫—É',
        step1Desc: '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ü–µ–Ω—É –∑–∞–∫—É–ø–∫–∏.',
        step2: '–û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–æ–¥–∞–∂—É',
        step2Desc: '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä, —É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏.',
        step3: '–°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–±—ã–ª—å',
        step3Desc: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç –ø—Ä–∏–±—ã–ª—å.',
        userReviews: '–û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
        leaveReview: '–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',
        writeReview: '–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤...',
        sendReview: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',
        loginToReview: '–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',
        footer: '–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ',
        
        // Auth
        authTitle: '–£—á–µ—Ç –∑–∞–∫—É–ø–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º –ø—Ä–∏–±—ã–ª–∏',
        register: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
        yourName: '–í–∞—à–µ –∏–º—è',
        namePlaceholder: '–ò–≤–∞–Ω',
        loginOrEmail: '–õ–æ–≥–∏–Ω –∏–ª–∏ Email',
        loginPlaceholder: 'ivan123 –∏–ª–∏ email@example.com',
        email: 'Email',
        emailRequired: '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è',
        password: '–ü–∞—Ä–æ–ª—å',
        forgotPassword: '–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?',
        backToHome: '‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é',
        resetPassword: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è',
        resetCodeSent: '–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞',
        checkSpam: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º". –ö–æ–¥ –≤ –ø–∏—Å—å–º–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ.',
        resetCode: '–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',
        resetCodePlaceholder: '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ –ø–∏—Å—å–º–∞',
        newPassword: '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å',
        passwordMin: '–ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞',
        confirmPassword: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å',
        confirmPasswordPlaceholder: '–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å',
        changePassword: '–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å',
        backToLogin: '‚Üê –ù–∞–∑–∞–¥ –∫ –≤—Ö–æ–¥—É',
        
        // App
        logout: '–í—ã–π—Ç–∏',
        menu: '–ú–µ–Ω—é',
        profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        add: '–î–æ–±–∞–≤–∏—Ç—å',
        history: '–ò—Å—Ç–æ—Ä–∏—è',
        summary: '–°–≤–æ–¥–∫–∞',
        dashboard: '–î–∞—à–±–æ—Ä–¥',
        support: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
        darkTheme: '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞',
        
        // Profile
        emailLabel: 'Email',
        updateEmail: '–û–±–Ω–æ–≤–∏—Ç—å email',
        security: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
        changePasswordBtn: '–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å',
        language: '–Ø–∑—ã–∫',
        currency: '–í–∞–ª—é—Ç–∞',
        currentPassword: '–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å',
        newPasswordLabel: '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å',
        confirmPasswordLabel: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å',
        
        // Currency conversion
        confirmCurrencyChange: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–º–µ–Ω—ã –≤–∞–ª—é—Ç—ã',
        currencyChangeDesc: '–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞–ª—é—Ç—É',
        exchangeRate: '–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å –æ–±–º–µ–Ω–∞:',
        conversionInfo: '–í—Å–µ –≤–∞—à–∏ –∑–∞–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ –±—É–¥—É—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —ç—Ç–æ–º—É –∫—É—Ä—Å—É.',
        converting: '–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...',
        confirm: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
        currencyChanged: '–í–∞–ª—é—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞!',
        purchasesConverted: '–∑–∞–∫—É–ø–æ–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ',
        salesConverted: '–ø—Ä–æ–¥–∞–∂ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ',
        
        // Stats
        totalPurchases: '–í—Å–µ–≥–æ –∑–∞–∫—É–ø–æ–∫',
        totalSales: '–í—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂',
        revenue: '–í—ã—Ä—É—á–∫–∞',
        profit: '–ü—Ä–∏–±—ã–ª—å',
        
        // Branch
        newBranch: '–ù–æ–≤–∞—è –≤–µ—Ç–∫–∞',
        deleteBranch: '–£–¥–∞–ª–∏—Ç—å',
        branchName: '–ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏',
        create: '–°–æ–∑–¥–∞—Ç—å',
        cancel: '–û—Ç–º–µ–Ω–∞',
        
        // Purchase
        newPurchase: '–ù–æ–≤–∞—è –∑–∞–∫—É–ø–∫–∞',
        productName: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
        productPlaceholder: '–ù–∞–ø—Ä–∏–º–µ—Ä: iPhone 15',
        quantity: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
        price: '–¶–µ–Ω–∞ –∑–∞ —à—Ç',
        date: '–î–∞—Ç–∞',
        photo: '–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞',
        notes: '–ó–∞–º–µ—Ç–∫–∏',
        notesPlaceholder: '–û–ø–∏—Å–∞–Ω–∏–µ, –ø–æ—Å—Ç–∞–≤—â–∏–∫, —É—Å–ª–æ–≤–∏—è...',
        total: '–ò—Ç–æ–≥–æ',
        addPurchase: '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫—É–ø–∫—É',
        
        // Sale
        newSale: '–ù–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞',
        product: '–¢–æ–≤–∞—Ä',
        selectProduct: '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä',
        remaining: '–æ—Å—Ç–∞–ª–æ—Å—å',
        salePrice: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏',
        saleNotesPlaceholder: '–ì–¥–µ –ø—Ä–æ–¥–∞–ª, –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è...',
        addSale: '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É',
        sell: '–ü—Ä–æ–¥–∞—Ç—å',
        quickSell: '–ü—Ä–æ–¥–∞—Ç—å',
        date: '–î–∞—Ç–∞',
        total: '–ò—Ç–æ–≥–æ',
        
        // History
        purchaseHistory: '–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—É–ø–æ–∫',
        saleHistory: '–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂',
        photoCol: '–§–æ—Ç–æ',
        productCol: '–¢–æ–≤–∞—Ä',
        qtyCol: '–ö–æ–ª-–≤–æ',
        remainingCol: '–û—Å—Ç–∞–ª–æ—Å—å',
        priceCol: '–¶–µ–Ω–∞',
        amountCol: '–°—É–º–º–∞',
        purchasePriceCol: '–ó–∞–∫—É–ø–∫–∞',
        salePriceCol: '–ü—Ä–æ–¥–∞–∂–∞',
        profitCol: '–ü—Ä–∏–±—ã–ª—å',
        dateCol: '–î–∞—Ç–∞',
        notesCol: '–ó–∞–º–µ—Ç–∫–∏',
        delete: '–£–¥–∞–ª–∏—Ç—å',
        edit: '–ò–∑–º–µ–Ω–∏—Ç—å',
        save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        addNotes: '–î–æ–±–∞–≤–∏—Ç—å',
        
        // Summary
        monthlySummaryTitle: '–°–≤–æ–¥–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü',
        byProduct: '–ü–æ —Ç–æ–≤–∞—Ä–∞–º:',
        purchased: '–ó–∞–∫—É–ø–ª–µ–Ω–æ',
        sold: '–ü—Ä–æ–¥–∞–Ω–æ',
        inStock: '–¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏',
        stock: '–û—Å—Ç–∞—Ç–æ–∫',
        noStock: '–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏',
        pieces: '—à—Ç',
        action: '–î–µ–π—Å—Ç–≤–∏–µ',
        
        // Dashboard
        dashboardTitle: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏',
        profitChart: '–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–±—ã–ª–∏',
        salesByBranch: '–ü—Ä–æ–¥–∞–∂–∏ –ø–æ –≤–µ—Ç–∫–∞–º',
        topProducts: '–¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø—Ä–∏–±—ã–ª–∏',
        day: '–î–µ–Ω—å',
        week: '–ù–µ–¥–µ–ª—è',
        month: '–ú–µ—Å—è—Ü',
        allTime: '–í—Å–µ –≤—Ä–µ–º—è',
        revenue: '–í—ã—Ä—É—á–∫–∞',
        profit: '–ü—Ä–∏–±—ã–ª—å',
        sales: '–ü—Ä–æ–¥–∞–∂–∏',
        purchases: '–ó–∞–∫—É–ø–∫–∏',
        totalProfit: '–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å',
        totalRevenue: '–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞',
        avgProfit: '–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å',
        transactions: '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏',
        
        // Calendar Dashboard
        calendarTitle: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–¥–µ–ª–æ–∫',
        calendar: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å',
        purchase: '–ó–∞–∫—É–ø–∫–∞',
        sale: '–ü—Ä–æ–¥–∞–∂–∞',
        quantity: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
        price: '–¶–µ–Ω–∞',
        total: '–ò—Ç–æ–≥–æ',
        branch: '–í–µ—Ç–∫–∞',
        date: '–î–∞—Ç–∞',
        notes: '–ó–∞–º–µ—Ç–∫–∏',
        noTransactions: '–ù–µ—Ç —Å–¥–µ–ª–æ–∫',
        clickForDetails: '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π',
        close: '–ó–∞–∫—Ä—ã—Ç—å',
        transactionDetails: '–î–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏',
        product: '–¢–æ–≤–∞—Ä',
        purchasePrice: '–¶–µ–Ω–∞ –∑–∞–∫—É–ø–∫–∏',
        salePrice: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏',
        previousMonth: '‚Üê',
        nextMonth: '‚Üí',
        today: '–°–µ–≥–æ–¥–Ω—è',
        pieces: '—à—Ç',
        
        // Support
        faq: '–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã',
        myTickets: '–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è',
        newTicket: '–ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ',
        noTickets: '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π',
        ticketSubject: '–¢–µ–º–∞',
        subjectPlaceholder: '–û–ø–∏—à–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ–±–ª–µ–º—É',
        message: '–°–æ–æ–±—â–µ–Ω–∏–µ',
        messagePlaceholder: '–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å...',
        sendTicket: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ',
        back: '‚Üê –ù–∞–∑–∞–¥',
        open: '–û—Ç–∫—Ä—ã—Ç',
        closed: '–ó–∞–∫—Ä—ã—Ç',
        messages: '—Å–æ–æ–±—â–µ–Ω–∏–π',
        reply: '–í–∞—à –æ—Ç–≤–µ—Ç...',
        send: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
        
        // AI
        aiAssistant: '–ò–ò-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç',
        aiGreeting: '–ü—Ä–∏–≤–µ—Ç! –Ø –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ProfitTrack. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
        askQuestion: '–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å...',
        
        // Errors
        fillAllFields: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è',
        passwordsDontMatch: '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç',
        passwordMinError: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞',
        selectRating: '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥',
        writeReviewError: '–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤',
        enterEmail: '–í–≤–µ–¥–∏—Ç–µ email',
        emailRequiredError: 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è',
        lastBranchError: '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ç–∫—É',
        outOfStock: '–¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è!',
        
        // Admin
        adminPanel: '–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å',
        adminKey: '–ö–ª—é—á –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
        enterAdminKey: '–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
        verify: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        allTickets: '–í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è',
        from: '–û—Ç',
        reply: '–û—Ç–≤–µ—Ç–∏—Ç—å',
        sendReply: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç',
        replySent: '–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!',
        closeTicket: '–ó–∞–∫—Ä—ã—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ',
        confirmCloseTicket: '–ó–∞–∫—Ä—ã—Ç—å —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ?',
        ticketClosed: '–û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ',
        rateSupport: '–û—Ü–µ–Ω–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É',
        rateSupportDesc: '–ü–æ–º–æ–≥–ª–∏ –ª–∏ –º—ã –≤–∞–º? –ü–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5 –∑–≤–µ–∑–¥',
        skipRating: '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å',
        submitRating: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É',
        problemSolved: '–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞',
        yourRating: '–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞',
        closeWithoutRating: '–ó–∞–∫—Ä—ã—Ç—å –±–µ–∑ –æ—Ü–µ–Ω–∫–∏',
        supportStats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏',
        averageRating: '–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞',
        total: '–í—Å–µ–≥–æ',
        open: '–û—Ç–∫—Ä—ã—Ç—ã',
        closed: '–ó–∞–∫—Ä—ã—Ç—ã',
        ratings: '–û—Ü–µ–Ω–æ–∫',
      },
      en: {
        // Landing
        appName: 'ProfitTrack',
        tagline: 'Smart purchase and sales tracking for your business. Track profits, manage inventory, and analyze sales.',
        startFree: 'Start for free',
        login: 'Login',
        users: 'active users',
        reviews: 'positive reviews',
        salesTracked: 'in tracked sales',
        features: 'App Features',
        autoProfit: 'Automatic Profit Calculation',
        autoProfitDesc: 'The system automatically calculates your profit for each sale',
        photos: 'Product Photos',
        photosDesc: 'Add photos to purchases - they will automatically appear when selling',
        notes: 'Notes & Descriptions',
        notesDesc: 'Keep notes for each transaction: contacts, conditions, sale location',
        categories: 'Product Categories',
        categoriesDesc: 'Create separate branches for different product categories',
        inventory: 'Inventory Tracking',
        inventoryDesc: 'Track remaining quantity after each sale',
        monthlySummary: 'Monthly Summary',
        monthlySummaryDesc: 'Get detailed statistics for each product per month',
        howItWorks: 'How It Works',
        step1: 'Add a Purchase',
        step1Desc: 'Enter product name, quantity, and purchase price.',
        step2: 'Record a Sale',
        step2Desc: 'Select product, enter quantity and sale price.',
        step3: 'View Profit',
        step3Desc: 'The app automatically calculates profit.',
        userReviews: 'User Reviews',
        leaveReview: 'Leave a Review',
        writeReview: 'Write your review...',
        sendReview: 'Send Review',
        loginToReview: 'Login to leave a review',
        footer: 'All data is stored on the server',
        
        // Auth
        authTitle: 'Purchase and sales tracking with automatic profit calculation',
        register: 'Register',
        yourName: 'Your Name',
        namePlaceholder: 'John',
        loginOrEmail: 'Login or Email',
        loginPlaceholder: 'john123 or email@example.com',
        email: 'Email',
        emailRequired: 'Required for password recovery',
        password: 'Password',
        forgotPassword: 'Forgot password?',
        backToHome: '‚Üê Back to home',
        resetPassword: 'Password Recovery',
        resetCodeSent: 'Code sent to',
        checkSpam: 'Check your "Spam" folder. The code is in English.',
        resetCode: 'Verification Code',
        resetCodePlaceholder: 'Enter code from email',
        newPassword: 'New Password',
        passwordMin: 'Minimum 4 characters',
        confirmPassword: 'Confirm New Password',
        confirmPasswordPlaceholder: 'Repeat password',
        changePassword: 'Change Password',
        backToLogin: '‚Üê Back to login',
        
        // App
        logout: 'Logout',
        menu: 'Menu',
        profile: 'Profile',
        add: 'Add',
        history: 'History',
        summary: 'Summary',
        dashboard: 'Dashboard',
        support: 'Support',
        darkTheme: 'Dark Theme',
        
        // Profile
        emailLabel: 'Email',
        updateEmail: 'Update Email',
        security: 'Security',
        changePasswordBtn: 'Change Password',
        language: 'Language',
        currency: 'Currency',
        currentPassword: 'Current Password',
        newPasswordLabel: 'New Password',
        confirmPasswordLabel: 'Confirm New Password',
        
        // Currency conversion
        confirmCurrencyChange: 'Confirm Currency Change',
        currencyChangeDesc: 'You are about to change currency',
        exchangeRate: 'Current exchange rate:',
        conversionInfo: 'All your purchases and sales will be converted at this rate.',
        converting: 'Converting...',
        confirm: 'Confirm',
        currencyChanged: 'Currency changed!',
        purchasesConverted: 'purchases converted',
        salesConverted: 'sales converted',
        
        // Stats
        totalPurchases: 'Total Purchases',
        totalSales: 'Total Sales',
        revenue: 'Revenue',
        profit: 'Profit',
        
        // Branch
        newBranch: 'New Branch',
        deleteBranch: 'Delete',
        branchName: 'Branch Name',
        create: 'Create',
        cancel: 'Cancel',
        
        // Purchase
        newPurchase: 'New Purchase',
        productName: 'Product Name',
        productPlaceholder: 'e.g. iPhone 15',
        quantity: 'Quantity',
        price: 'Price per unit',
        date: 'Date',
        photo: 'Product Photo',
        notes: 'Notes',
        notesPlaceholder: 'Description, supplier, conditions...',
        total: 'Total',
        addPurchase: 'Add Purchase',
        
        // Sale
        newSale: 'New Sale',
        product: 'Product',
        selectProduct: 'Select product',
        remaining: 'remaining',
        salePrice: 'Sale Price',
        saleNotesPlaceholder: 'Where sold, buyer contacts...',
        addSale: 'Add Sale',
        sell: 'Sell',
        quickSell: 'Sell',
        date: 'Date',
        total: 'Total',
        
        // History
        purchaseHistory: 'Purchase History',
        saleHistory: 'Sales History',
        photoCol: 'Photo',
        productCol: 'Product',
        qtyCol: 'Qty',
        remainingCol: 'Remaining',
        priceCol: 'Price',
        amountCol: 'Amount',
        purchasePriceCol: 'Purchase',
        salePriceCol: 'Sale',
        profitCol: 'Profit',
        dateCol: 'Date',
        notesCol: 'Notes',
        delete: 'Delete',
        edit: 'Edit',
        save: 'Save',
        addNotes: 'Add',
        
        // Summary
        monthlySummaryTitle: 'Monthly Summary',
        byProduct: 'By Product:',
        purchased: 'Purchased',
        sold: 'Sold',
        inStock: 'Products in Stock',
        stock: 'Stock',
        noStock: 'No products in stock',
        pieces: 'pcs',
        action: 'Action',
        
        // Dashboard
        dashboardTitle: 'Analytics & Charts',
        profitChart: 'Profit Chart',
        salesByBranch: 'Sales by Branch',
        topProducts: 'Top Products by Profit',
        day: 'Day',
        week: 'Week',
        month: 'Month',
        allTime: 'All Time',
        revenue: 'Revenue',
        profit: 'Profit',
        sales: 'Sales',
        purchases: 'Purchases',
        totalProfit: 'Total Profit',
        totalRevenue: 'Total Revenue',
        avgProfit: 'Average Profit',
        transactions: 'Transactions',
        
        // Calendar Dashboard
        calendarTitle: 'Transaction Calendar',
        calendar: 'Calendar',
        purchase: 'Purchase',
        sale: 'Sale',
        quantity: 'Quantity',
        price: 'Price',
        total: 'Total',
        branch: 'Branch',
        date: 'Date',
        notes: 'Notes',
        noTransactions: 'No transactions',
        clickForDetails: 'Click for details',
        close: 'Close',
        transactionDetails: 'Transaction Details',
        product: 'Product',
        purchasePrice: 'Purchase Price',
        salePrice: 'Sale Price',
        previousMonth: '‚Üê',
        nextMonth: '‚Üí',
        today: 'Today',
        pieces: 'pcs',
        
        // Support
        faq: 'Frequently Asked Questions',
        myTickets: 'My Tickets',
        newTicket: 'New Ticket',
        noTickets: 'You have no tickets yet',
        ticketSubject: 'Subject',
        subjectPlaceholder: 'Briefly describe the problem',
        message: 'Message',
        messagePlaceholder: 'Describe your problem or question in detail...',
        sendTicket: 'Send Ticket',
        back: '‚Üê Back',
        open: 'Open',
        closed: 'Closed',
        messages: 'messages',
        reply: 'Your reply...',
        send: 'Send',
        
        // AI
        aiAssistant: 'AI Assistant',
        aiGreeting: 'Hello! I am ProfitTrack AI assistant. How can I help you?',
        askQuestion: 'Ask a question...',
        
        // Errors
        fillAllFields: 'Fill all fields',
        passwordsDontMatch: 'Passwords do not match',
        passwordMinError: 'Password must be at least 4 characters',
        selectRating: 'Select a rating',
        writeReviewError: 'Write a review',
        enterEmail: 'Enter email',
        emailRequiredError: 'Email is required for password recovery',
        lastBranchError: 'Cannot delete the last branch',
        outOfStock: 'Product is out of stock!',
        
        // Admin
        adminPanel: 'Admin Panel',
        adminKey: 'Admin Key',
        enterAdminKey: 'Enter admin key',
        verify: 'Verify',
        allTickets: 'All Tickets',
        from: 'From',
        reply: 'Reply',
        sendReply: 'Send Reply',
        replySent: 'Reply sent!',
        closeTicket: 'Close Ticket',
        confirmCloseTicket: 'Close this ticket?',
        ticketClosed: 'Ticket closed',
        rateSupport: 'Rate Support',
        rateSupportDesc: 'Did we help you? Rate us from 1 to 5 stars',
        skipRating: 'Skip',
        submitRating: 'Submit Rating',
        problemSolved: 'Problem solved',
        yourRating: 'Your rating',
        closeWithoutRating: 'Close without rating',
        supportStats: 'Support Statistics',
        averageRating: 'Average rating',
        total: 'Total',
        open: 'Open',
        closed: 'Closed',
        ratings: 'Ratings',
      }
    };

    // Currency settings
    const currencies = {
      EUR: { code: 'EUR', symbol: '‚Ç¨', locale: 'de-DE', name: { ru: '–ï–≤—Ä–æ', en: 'Euro' } },
      USD: { code: 'USD', symbol: '$', locale: 'en-US', name: { ru: '–î–æ–ª–ª–∞—Ä', en: 'Dollar' } },
      UAH: { code: 'UAH', symbol: '‚Ç¥', locale: 'uk-UA', name: { ru: '–ì—Ä–∏–≤–Ω–∞', en: 'Hryvnia' } }
    };

    // Calendar Dashboard Component
    function CalendarDashboard({ sales, purchases, branches, currency, language, formatCurrency }) {
      const { useState, useEffect } = React;
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const [selectedTransaction, setSelectedTransaction] = useState(null);
      
      const t = (key) => {
        const translations = {
          ru: {
            calendarTitle: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–¥–µ–ª–æ–∫',
            purchase: '–ó–∞–∫—É–ø–∫–∞',
            sale: '–ü—Ä–æ–¥–∞–∂–∞',
            profit: '–ü—Ä–∏–±—ã–ª—å',
            revenue: '–í—ã—Ä—É—á–∫–∞',
            quantity: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
            price: '–¶–µ–Ω–∞',
            total: '–ò—Ç–æ–≥–æ',
            branch: '–í–µ—Ç–∫–∞',
            date: '–î–∞—Ç–∞',
            notes: '–ó–∞–º–µ—Ç–∫–∏',
            noTransactions: '–ù–µ—Ç —Å–¥–µ–ª–æ–∫',
            clickForDetails: '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π',
            close: '–ó–∞–∫—Ä—ã—Ç—å',
            transactionDetails: '–î–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏',
            product: '–¢–æ–≤–∞—Ä',
            purchasePrice: '–¶–µ–Ω–∞ –∑–∞–∫—É–ø–∫–∏',
            salePrice: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏',
            previousMonth: '‚Üê',
            nextMonth: '‚Üí',
            today: '–°–µ–≥–æ–¥–Ω—è'
          },
          en: {
            calendarTitle: 'Transaction Calendar',
            purchase: 'Purchase',
            sale: 'Sale',
            profit: 'Profit',
            revenue: 'Revenue',
            quantity: 'Quantity',
            price: 'Price',
            total: 'Total',
            branch: 'Branch',
            date: 'Date',
            notes: 'Notes',
            noTransactions: 'No transactions',
            clickForDetails: 'Click for details',
            close: 'Close',
            transactionDetails: 'Transaction Details',
            product: 'Product',
            purchasePrice: 'Purchase Price',
            salePrice: 'Sale Price',
            previousMonth: '‚Üê',
            nextMonth: '‚Üí',
            today: 'Today'
          }
        };
        return translations[language][key] || key;
      };

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay() || 7; // 1 = Monday
        
        const days = [];
        // Add empty cells for days before the first day of month
        for (let i = 1; i < startingDay; i++) {
          days.push(null);
        }
        // Add days of the month
        for (let i = 1; i <= daysInMonth; i++) {
          days.push(i);
        }
        return days;
      };

      const getTransactionsForDate = (day) => {
        if (!day) return [];
        const dateStr = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day).toISOString().split('T')[0];
        
        const dayPurchases = purchases.filter(p => p.date === dateStr).map(p => ({ ...p, type: 'purchase' }));
        const daySales = sales.filter(s => s.date === dateStr).map(s => ({ ...s, type: 'sale' }));
        
        return [...dayPurchases, ...daySales].sort((a, b) => new Date(a.createdAt || a.date) - new Date(b.createdAt || b.date));
      };

      const getBranchName = (branchId) => {
        const branch = branches.find(b => b.id === branchId);
        return branch ? branch.name : '-';
      };

      const monthNames = {
        ru: ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'],
        en: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
      };

      const weekDays = {
        ru: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
        en: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
      };

      const days = getDaysInMonth(currentMonth);

      return (
        <div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
            <h3 style={{ color: 'var(--text-primary)', margin: 0 }}>üìÖ {t('calendarTitle')}</h3>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <button 
                className="btn" 
                onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1))}
                style={{ padding: '8px 12px' }}
              >
                {t('previousMonth')}
              </button>
              <span style={{ fontSize: '18px', fontWeight: '600', color: 'var(--text-primary)', minWidth: '150px', textAlign: 'center' }}>
                {monthNames[language][currentMonth.getMonth()]} {currentMonth.getFullYear()}
              </span>
              <button 
                className="btn" 
                onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1))}
                style={{ padding: '8px 12px' }}
              >
                {t('nextMonth')}
              </button>
              <button 
                className="btn btn-secondary" 
                onClick={() => setCurrentMonth(new Date())}
                style={{ padding: '8px 16px', marginLeft: '8px' }}
              >
                {t('today')}
              </button>
            </div>
          </div>

          {/* Calendar Grid */}
          <div style={{ background: 'var(--bg-card)', borderRadius: '12px', border: '1px solid var(--border-color)', overflow: 'hidden' }}>
            {/* Week days header */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', background: 'var(--bg-primary)', borderBottom: '1px solid var(--border-color)' }}>
              {weekDays[language].map(day => (
                <div key={day} style={{ padding: '12px', textAlign: 'center', fontWeight: '600', color: 'var(--text-secondary)', fontSize: '14px' }}>
                  {day}
                </div>
              ))}
            </div>
            
            {/* Days grid */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)' }}>
              {days.map((day, idx) => {
                const transactions = day ? getTransactionsForDate(day) : [];
                const hasPurchases = transactions.some(t => t.type === 'purchase');
                const hasSales = transactions.some(t => t.type === 'sale');
                const dayProfit = transactions.filter(t => t.type === 'sale').reduce((sum, t) => sum + (t.profit || 0), 0);
                
                return (
                  <div 
                    key={idx}
                    onClick={() => day && transactions.length > 0 && setSelectedDate({ day, transactions })}
                    style={{
                      minHeight: '100px',
                      padding: '8px',
                      borderRight: (idx + 1) % 7 !== 0 ? '1px solid var(--border-color)' : 'none',
                      borderBottom: idx < days.length - 7 ? '1px solid var(--border-color)' : 'none',
                      background: day ? 'var(--bg-card)' : 'var(--bg-primary)',
                      cursor: transactions.length > 0 ? 'pointer' : 'default',
                      opacity: day ? 1 : 0.5
                    }}
                  >
                    {day && (
                      <>
                        <div style={{ 
                          fontSize: '14px', 
                          fontWeight: '600', 
                          color: 'var(--text-primary)',
                          marginBottom: '4px'
                        }}>
                          {day}
                        </div>
                        {transactions.length > 0 && (
                          <div style={{ display: 'flex', flexDirection: 'column', gap: '2px' }}>
                            {hasPurchases && (
                              <div style={{ 
                                fontSize: '10px', 
                                padding: '2px 4px', 
                                background: '#dbeafe', 
                                color: '#2563eb',
                                borderRadius: '3px',
                                fontWeight: '600'
                              }}>
                                üõí {transactions.filter(t => t.type === 'purchase').length}
                              </div>
                            )}
                            {hasSales && (
                              <div style={{ 
                                fontSize: '10px', 
                                padding: '2px 4px', 
                                background: dayProfit >= 0 ? '#d1fae5' : '#fee2e2', 
                                color: dayProfit >= 0 ? '#059669' : '#dc2626',
                                borderRadius: '3px',
                                fontWeight: '600'
                              }}>
                                üí∞ {formatCurrency(dayProfit)}
                              </div>
                            )}
                          </div>
                        )}
                      </>
                    )}
                  </div>
                );
              })}
            </div>
          </div>

          {/* Selected Date Modal */}
          {selectedDate && (
            <div className="modal-overlay" onClick={() => setSelectedDate(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '500px', maxHeight: '80vh', overflowY: 'auto' }}>
                <div className="modal-header">
                  <h3>üìÖ {selectedDate.day} {monthNames[language][currentMonth.getMonth()]} {currentMonth.getFullYear()}</h3>
                  <button className="close-modal" onClick={() => setSelectedDate(null)}>‚úï</button>
                </div>
                
                {selectedDate.transactions.length === 0 ? (
                  <p style={{ textAlign: 'center', color: 'var(--text-secondary)', padding: '24px' }}>{t('noTransactions')}</p>
                ) : (
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    {selectedDate.transactions.map((t, idx) => (
                      <div 
                        key={idx}
                        onClick={() => setSelectedTransaction(t)}
                        style={{
                          padding: '16px',
                          background: 'var(--bg-primary)',
                          borderRadius: '8px',
                          borderLeft: `4px solid ${t.type === 'purchase' ? '#3b82f6' : '#22c55e'}`,
                          cursor: 'pointer'
                        }}
                      >
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <div>
                            <span style={{ 
                              fontSize: '12px', 
                              padding: '2px 6px', 
                              background: t.type === 'purchase' ? '#dbeafe' : '#d1fae5',
                              color: t.type === 'purchase' ? '#2563eb' : '#059669',
                              borderRadius: '4px',
                              fontWeight: '600',
                              marginRight: '8px'
                            }}>
                              {t.type === 'purchase' ? 'üõí ' + translations[language].purchase : 'üí∞ ' + translations[language].sale}
                            </span>
                            <strong style={{ color: 'var(--text-primary)' }}>{t.productName}</strong>
                          </div>
                          <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>
                            {formatCurrency(t.type === 'purchase' ? t.total : t.totalRevenue)}
                          </span>
                        </div>
                        <div style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '8px' }}>
                          {getBranchName(t.branchId)} ¬∑ {t.quantity} {language === 'ru' ? '—à—Ç' : 'pcs'}
                          {t.type === 'sale' && (
                            <span style={{ 
                              marginLeft: '8px',
                              color: t.profit >= 0 ? '#059669' : '#dc2626',
                              fontWeight: '600'
                            }}>
                              {t.profit >= 0 ? '+' : ''}{formatCurrency(t.profit)}
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Transaction Details Modal */}
          {selectedTransaction && (
            <div className="modal-overlay" onClick={() => setSelectedTransaction(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '450px' }}>
                <div className="modal-header">
                  <h3>üìã {t('transactionDetails')}</h3>
                  <button className="close-modal" onClick={() => setSelectedTransaction(null)}>‚úï</button>
                </div>
                
                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                  {/* Transaction Type Badge */}
                  <div style={{ textAlign: 'center' }}>
                    <span style={{ 
                      fontSize: '14px', 
                      padding: '6px 16px', 
                      background: selectedTransaction.type === 'purchase' ? '#dbeafe' : '#d1fae5',
                      color: selectedTransaction.type === 'purchase' ? '#2563eb' : '#059669',
                      borderRadius: '20px',
                      fontWeight: '600'
                    }}>
                      {selectedTransaction.type === 'purchase' ? 'üõí ' + t('purchase') : 'üí∞ ' + t('sale')}
                    </span>
                  </div>

                  {/* Product Photo */}
                  {selectedTransaction.photo && (
                    <div style={{ textAlign: 'center' }}>
                      <img 
                        src={selectedTransaction.photo} 
                        alt={selectedTransaction.productName}
                        style={{ maxWidth: '200px', maxHeight: '200px', borderRadius: '8px', objectFit: 'cover' }}
                      />
                    </div>
                  )}

                  {/* Details Grid */}
                  <div style={{ display: 'grid', gap: '12px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                      <span style={{ color: 'var(--text-secondary)' }}>{t('product')}</span>
                      <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{selectedTransaction.productName}</span>
                    </div>
                    
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                      <span style={{ color: 'var(--text-secondary)' }}>{t('branch')}</span>
                      <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{getBranchName(selectedTransaction.branchId)}</span>
                    </div>
                    
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                      <span style={{ color: 'var(--text-secondary)' }}>{t('date')}</span>
                      <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{selectedTransaction.date}</span>
                    </div>
                    
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                      <span style={{ color: 'var(--text-secondary)' }}>{t('quantity')}</span>
                      <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{selectedTransaction.quantity}</span>
                    </div>
                    
                    {selectedTransaction.type === 'purchase' ? (
                      <>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                          <span style={{ color: 'var(--text-secondary)' }}>{t('price')}</span>
                          <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{formatCurrency(selectedTransaction.price)}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: '#dbeafe', borderRadius: '8px' }}>
                          <span style={{ color: '#2563eb', fontWeight: '600' }}>{t('total')}</span>
                          <span style={{ fontWeight: 'bold', color: '#2563eb' }}>{formatCurrency(selectedTransaction.total)}</span>
                        </div>
                      </>
                    ) : (
                      <>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                          <span style={{ color: 'var(--text-secondary)' }}>{t('purchasePrice')}</span>
                          <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{formatCurrency(selectedTransaction.purchasePrice)}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                          <span style={{ color: 'var(--text-secondary)' }}>{t('salePrice')}</span>
                          <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{formatCurrency(selectedTransaction.salePrice)}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: '#d1fae5', borderRadius: '8px' }}>
                          <span style={{ color: '#059669', fontWeight: '600' }}>{t('revenue')}</span>
                          <span style={{ fontWeight: 'bold', color: '#059669' }}>{formatCurrency(selectedTransaction.totalRevenue)}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px', background: selectedTransaction.profit >= 0 ? '#d1fae5' : '#fee2e2', borderRadius: '8px' }}>
                          <span style={{ color: selectedTransaction.profit >= 0 ? '#059669' : '#dc2626', fontWeight: '600' }}>{t('profit')}</span>
                          <span style={{ fontWeight: 'bold', color: selectedTransaction.profit >= 0 ? '#059669' : '#dc2626' }}>
                            {selectedTransaction.profit >= 0 ? '+' : ''}{formatCurrency(selectedTransaction.profit)}
                          </span>
                        </div>
                      </>
                    )}
                    
                    {selectedTransaction.notes && (
                      <div style={{ padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                        <span style={{ color: 'var(--text-secondary)', display: 'block', marginBottom: '4px' }}>{t('notes')}</span>
                        <span style={{ color: 'var(--text-primary)', fontStyle: 'italic' }}>{selectedTransaction.notes}</span>
                      </div>
                    )}
                  </div>

                  <button className="btn" onClick={() => setSelectedTransaction(null)} style={{ marginTop: '8px' }}>
                    {t('close')}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Dashboard Component - shows Calendar
    function Dashboard({ sales, purchases, branches, currency, language, formatCurrency }) {
      return (
        <CalendarDashboard 
          sales={sales} 
          purchases={purchases} 
          branches={branches}
          currency={currency}
          language={language}
          formatCurrency={formatCurrency}
        />
      );
    }

    // Charts Component for main page
    function ChartsSection({ sales, purchases, branches, currency, language, formatCurrency }) {
      const { useState, useEffect, useRef } = React;
      const [period, setPeriod] = useState('month');
      const profitChartRef = useRef(null);
      const branchChartRef = useRef(null);
      const topProductsChartRef = useRef(null);
      
      const t = (key) => {
        const translations = {
          ru: {
            profitChart: '–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–±—ã–ª–∏',
            salesByBranch: '–ü—Ä–æ–¥–∞–∂–∏ –ø–æ –≤–µ—Ç–∫–∞–º',
            topProducts: '–¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø—Ä–∏–±—ã–ª–∏',
            day: '–î–µ–Ω—å',
            week: '–ù–µ–¥–µ–ª—è',
            month: '–ú–µ—Å—è—Ü',
            allTime: '–í—Å–µ –≤—Ä–µ–º—è',
            revenue: '–í—ã—Ä—É—á–∫–∞',
            profit: '–ü—Ä–∏–±—ã–ª—å',
            purchases: '–ó–∞–∫—É–ø–∫–∏',
            noData: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'
          },
          en: {
            profitChart: 'Profit Chart',
            salesByBranch: 'Sales by Branch',
            topProducts: 'Top Products by Profit',
            day: 'Day',
            week: 'Week',
            month: 'Month',
            allTime: 'All Time',
            revenue: 'Revenue',
            profit: 'Profit',
            purchases: 'Purchases',
            noData: 'No data'
          }
        };
        return translations[language][key] || key;
      };

      // Filter data by period
      const getFilteredData = () => {
        const now = new Date();
        const cutoffDate = new Date();
        
        switch(period) {
          case 'day':
            cutoffDate.setDate(now.getDate() - 1);
            break;
          case 'week':
            cutoffDate.setDate(now.getDate() - 7);
            break;
          case 'month':
            cutoffDate.setMonth(now.getMonth() - 1);
            break;
          case 'allTime':
            cutoffDate.setFullYear(2000);
            break;
          default:
            cutoffDate.setMonth(now.getMonth() - 1);
        }
        
        const filteredSales = sales.filter(s => new Date(s.date) >= cutoffDate);
        const filteredPurchases = purchases.filter(p => new Date(p.date) >= cutoffDate);
        
        return { filteredSales, filteredPurchases };
      };

      const { filteredSales, filteredPurchases } = getFilteredData();
      
      // Calculate stats
      const totalProfit = filteredSales.reduce((sum, s) => sum + s.profit, 0);
      const totalRevenue = filteredSales.reduce((sum, s) => sum + s.totalRevenue, 0);
      const totalPurchasesAmount = filteredPurchases.reduce((sum, p) => sum + p.total, 0);
      const avgProfit = filteredSales.length > 0 ? totalProfit / filteredSales.length : 0;

      // Prepare chart data
      const getProfitChartData = () => {
        const dataMap = new Map();
        
        filteredSales.forEach(sale => {
          const date = new Date(sale.date).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'en-US', { 
            day: '2-digit', 
            month: 'short' 
          });
          if (!dataMap.has(date)) {
            dataMap.set(date, { profit: 0, revenue: 0, purchases: 0 });
          }
          dataMap.get(date).profit += sale.profit;
          dataMap.get(date).revenue += sale.totalRevenue;
        });
        
        filteredPurchases.forEach(purchase => {
          const date = new Date(purchase.date).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'en-US', { 
            day: '2-digit', 
            month: 'short' 
          });
          if (!dataMap.has(date)) {
            dataMap.set(date, { profit: 0, revenue: 0, purchases: 0 });
          }
          dataMap.get(date).purchases += purchase.total;
        });
        
        const sortedDates = Array.from(dataMap.keys()).sort((a, b) => {
          const dateA = new Date(a.split('.').reverse().join('-'));
          const dateB = new Date(b.split('.').reverse().join('-'));
          return dateA - dateB;
        });
        
        return {
          labels: sortedDates,
          profit: sortedDates.map(d => dataMap.get(d).profit),
          revenue: sortedDates.map(d => dataMap.get(d).revenue),
          purchases: sortedDates.map(d => dataMap.get(d).purchases)
        };
      };

      const getBranchData = () => {
        const branchMap = new Map();
        branches.forEach(b => branchMap.set(b.id, { name: b.name, sales: 0, profit: 0 }));
        
        filteredSales.forEach(sale => {
          if (branchMap.has(sale.branchId)) {
            branchMap.get(sale.branchId).sales += sale.totalRevenue;
            branchMap.get(sale.branchId).profit += sale.profit;
          }
        });
        
        return Array.from(branchMap.values()).filter(b => b.sales > 0);
      };

      const getTopProducts = () => {
        const productMap = new Map();
        
        filteredSales.forEach(sale => {
          if (!productMap.has(sale.productName)) {
            productMap.set(sale.productName, { name: sale.productName, profit: 0, quantity: 0 });
          }
          productMap.get(sale.productName).profit += sale.profit;
          productMap.get(sale.productName).quantity += sale.quantity;
        });
        
        return Array.from(productMap.values())
          .sort((a, b) => b.profit - a.profit)
          .slice(0, 10);
      };

      // Create charts
      useEffect(() => {
        if (filteredSales.length === 0 && filteredPurchases.length === 0) return;

        const profitData = getProfitChartData();
        const branchData = getBranchData();
        const topProductsData = getTopProducts();

        // Profit Chart
        if (profitChartRef.current) {
          const ctx = profitChartRef.current.getContext('2d');
          if (window.profitChartInstance) {
            window.profitChartInstance.destroy();
          }
          window.profitChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
              labels: profitData.labels,
              datasets: [
                {
                  label: t('profit'),
                  data: profitData.profit,
                  borderColor: '#22c55e',
                  backgroundColor: 'rgba(34, 197, 94, 0.1)',
                  fill: true,
                  tension: 0.4
                },
                {
                  label: t('revenue'),
                  data: profitData.revenue,
                  borderColor: '#3b82f6',
                  backgroundColor: 'rgba(59, 130, 246, 0.1)',
                  fill: true,
                  tension: 0.4
                },
                {
                  label: t('purchases'),
                  data: profitData.purchases,
                  borderColor: '#f59e0b',
                  backgroundColor: 'rgba(245, 158, 11, 0.1)',
                  fill: true,
                  tension: 0.4
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: 'top' }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: (value) => formatCurrency(value)
                  }
                }
              }
            }
          });
        }

        // Branch Chart
        if (branchChartRef.current && branchData.length > 0) {
          const ctx = branchChartRef.current.getContext('2d');
          if (window.branchChartInstance) {
            window.branchChartInstance.destroy();
          }
          window.branchChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: branchData.map(b => b.name),
              datasets: [{
                data: branchData.map(b => b.sales),
                backgroundColor: [
                  '#3b82f6', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6',
                  '#06b6d4', '#ec4899', '#84cc16', '#f97316', '#6366f1'
                ]
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: 'right' }
              }
            }
          });
        }

        // Top Products Chart
        if (topProductsChartRef.current && topProductsData.length > 0) {
          const ctx = topProductsChartRef.current.getContext('2d');
          if (window.topProductsChartInstance) {
            window.topProductsChartInstance.destroy();
          }
          window.topProductsChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: topProductsData.map(p => p.name.length > 15 ? p.name.substring(0, 15) + '...' : p.name),
              datasets: [{
                label: t('profit'),
                data: topProductsData.map(p => p.profit),
                backgroundColor: topProductsData.map(p => p.profit >= 0 ? '#22c55e' : '#ef4444')
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: (value) => formatCurrency(value)
                  }
                }
              }
            }
          });
        }

        return () => {
          if (window.profitChartInstance) window.profitChartInstance.destroy();
          if (window.branchChartInstance) window.branchChartInstance.destroy();
          if (window.topProductsChartInstance) window.topProductsChartInstance.destroy();
        };
      }, [filteredSales, filteredPurchases, period, language]);

      const hasData = filteredSales.length > 0 || filteredPurchases.length > 0;

      return (
        <div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
            <h3 style={{ color: 'var(--text-primary)', margin: 0 }}>üìà {t('dashboardTitle')}</h3>
            <div style={{ display: 'flex', gap: '8px' }}>
              {['day', 'week', 'month', 'allTime'].map(p => (
                <button
                  key={p}
                  className="btn"
                  onClick={() => setPeriod(p)}
                  style={{
                    padding: '6px 12px',
                    fontSize: '12px',
                    background: period === p ? '#3b82f6' : 'var(--bg-primary)',
                    color: period === p ? 'white' : 'var(--text-primary)'
                  }}
                >
                  {t(p)}
                </button>
              ))}
            </div>
          </div>

          {!hasData ? (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: 'var(--text-secondary)' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px' }}>üìä</div>
              <p>{t('noData')}</p>
            </div>
          ) : (
            <>
              {/* Stats Cards */}
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginBottom: '24px' }}>
                <div style={{ background: 'linear-gradient(135deg, #22c55e, #16a34a)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                  <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '8px' }}>{t('totalProfit')}</div>
                  <div style={{ fontSize: '24px', fontWeight: 'bold' }}>{formatCurrency(totalProfit)}</div>
                </div>
                <div style={{ background: 'linear-gradient(135deg, #3b82f6, #2563eb)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                  <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '8px' }}>{t('totalRevenue')}</div>
                  <div style={{ fontSize: '24px', fontWeight: 'bold' }}>{formatCurrency(totalRevenue)}</div>
                </div>
                <div style={{ background: 'linear-gradient(135deg, #f59e0b, #d97706)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                  <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '8px' }}>{t('purchases')}</div>
                  <div style={{ fontSize: '24px', fontWeight: 'bold' }}>{formatCurrency(totalPurchasesAmount)}</div>
                </div>
                <div style={{ background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                  <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '8px' }}>{t('transactions')}</div>
                  <div style={{ fontSize: '24px', fontWeight: 'bold' }}>{filteredSales.length + filteredPurchases.length}</div>
                </div>
              </div>

              {/* Charts Grid */}
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '20px' }}>
                {/* Profit Chart */}
                <div style={{ background: 'var(--bg-card)', padding: '20px', borderRadius: '12px', border: '1px solid var(--border-color)' }}>
                  <h4 style={{ marginBottom: '16px', color: 'var(--text-primary)' }}>{t('profitChart')}</h4>
                  <div style={{ height: '250px' }}>
                    <canvas ref={profitChartRef} />
                  </div>
                </div>

                {/* Sales by Branch */}
                <div style={{ background: 'var(--bg-card)', padding: '20px', borderRadius: '12px', border: '1px solid var(--border-color)' }}>
                  <h4 style={{ marginBottom: '16px', color: 'var(--text-primary)' }}>{t('salesByBranch')}</h4>
                  <div style={{ height: '250px' }}>
                    <canvas ref={branchChartRef} />
                  </div>
                </div>

                {/* Top Products */}
                <div style={{ background: 'var(--bg-card)', padding: '20px', borderRadius: '12px', border: '1px solid var(--border-color)', gridColumn: '1 / -1' }}>
                  <h4 style={{ marginBottom: '16px', color: 'var(--text-primary)' }}>{t('topProducts')}</h4>
                  <div style={{ height: '250px' }}>
                    <canvas ref={topProductsChartRef} />
                  </div>
                </div>
              </div>
            </>
          )}
        </div>
      );
    }

    function App() {
      const [theme, setTheme] = useState('light');
      const [token, setToken] = useState(null);
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [showLanding, setShowLanding] = useState(true);
      
      const [authMode, setAuthMode] = useState('login');
      const [loginInput, setLoginInput] = useState('');
      const [passwordInput, setPasswordInput] = useState('');
      const [userName, setUserName] = useState('');
      const [emailInput, setEmailInput] = useState('');
      const [authError, setAuthError] = useState('');
      const [authSuccess, setAuthSuccess] = useState('');
      const [authLoading, setAuthLoading] = useState(false);
      
      const [showForgotPassword, setShowForgotPassword] = useState(false);
      const [resetEmail, setResetEmail] = useState('');
      const [resetCode, setResetCode] = useState('');
      const [newResetPassword, setNewResetPassword] = useState('');
      const [resetStep, setResetStep] = useState(1);
      
      const [purchases, setPurchases] = useState([]);
      const [sales, setSales] = useState([]);
      const [branches, setBranches] = useState([]);
      const [currentBranchId, setCurrentBranchId] = useState('');
      const [reviews, setReviews] = useState(FAKE_REVIEWS);
      const [activeTab, setActiveTab] = useState('add');
      
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [showProfile, setShowProfile] = useState(false);
      const [showChangePassword, setShowChangePassword] = useState(false);
      const [currentPassword, setCurrentPassword] = useState('');
      const [newPassword, setNewPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [passwordSuccess, setPasswordSuccess] = useState('');
      const [passwordError, setPasswordError] = useState('');
      
      const [newBranchName, setNewBranchName] = useState('');
      const [showNewBranchForm, setShowNewBranchForm] = useState(false);
      
      const [purchaseName, setPurchaseName] = useState('');
      const [purchaseQty, setPurchaseQty] = useState('1');
      const [purchasePrice, setPurchasePrice] = useState('');
      const [purchaseDate, setPurchaseDate] = useState(new Date().toISOString().split('T')[0]);
      const [purchasePhoto, setPurchasePhoto] = useState('');
      const [purchaseNotes, setPurchaseNotes] = useState('');
      
      const [saleProduct, setSaleProduct] = useState('');
      const [saleQty, setSaleQty] = useState('1');
      const [salePurchasePrice, setSalePurchasePrice] = useState('');
      const [salePrice, setSalePrice] = useState('');
      const [saleDate, setSaleDate] = useState(new Date().toISOString().split('T')[0]);
      const [saleNotes, setSaleNotes] = useState('');
      
      const [quickSaleProduct, setQuickSaleProduct] = useState('');
      const [quickSalePhoto, setQuickSalePhoto] = useState('');
      const [quickSalePurchasePrice, setQuickSalePurchasePrice] = useState('');
      const [showQuickSale, setShowQuickSale] = useState(false);
      
      const [editingPurchaseId, setEditingPurchaseId] = useState('');
      const [editingSaleId, setEditingSaleId] = useState('');
      const [editNotes, setEditNotes] = useState('');
      
      const [previewPhoto, setPreviewPhoto] = useState('');
      const [showPreview, setShowPreview] = useState(false);
      
      const [newReviewRating, setNewReviewRating] = useState(0);
      const [newReviewText, setNewReviewText] = useState('');

      // Support system states
      const [faq, setFaq] = useState([]);
      const [tickets, setTickets] = useState([]);
      const [showSupport, setShowSupport] = useState(false);
      const [showNewTicket, setShowNewTicket] = useState(false);
      const [selectedTicket, setSelectedTicket] = useState(null);
      const [ticketSubject, setTicketSubject] = useState('');
      const [ticketMessage, setTicketMessage] = useState('');
      const [replyMessage, setReplyMessage] = useState('');
      const [aiChatOpen, setAiChatOpen] = useState(false);
      const [aiMessages, setAiMessages] = useState([{ from: 'ai', text: '–ü—Ä–∏–≤–µ—Ç! –Ø –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ProfitTrack. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?' }]);
      
      // Rating modal states
      const [showRatingModal, setShowRatingModal] = useState(false);
      const [ticketToClose, setTicketToClose] = useState(null);
      const [supportRating, setSupportRating] = useState(0);
      
      // Admin panel states
      const [showAdminPanel, setShowAdminPanel] = useState(false);
      const [adminKey, setAdminKey] = useState('');
      const [isAdminVerified, setIsAdminVerified] = useState(false);
      const [allTickets, setAllTickets] = useState([]);
      const [selectedAdminTicket, setSelectedAdminTicket] = useState(null);
      const [adminReplyMessage, setAdminReplyMessage] = useState('');
      const [adminKeyInput, setAdminKeyInput] = useState('');
      const [supportStats, setSupportStats] = useState(null);
      const [aiInput, setAiInput] = useState('');
      const [aiLoading, setAiLoading] = useState(false);
      const [expandedFAQ, setExpandedFAQ] = useState(null);
      
      // Language state
      const [language, setLanguage] = useState('ru');
      const LANG_KEY = 'profittrack_language';
      
      // Currency state
      const [currency, setCurrency] = useState('EUR');
      const CURRENCY_KEY = 'profittrack_currency';
      
      // Currency conversion confirmation states
      const [showCurrencyConfirm, setShowCurrencyConfirm] = useState(false);
      const [pendingCurrency, setPendingCurrency] = useState(null);
      const [exchangeRate, setExchangeRate] = useState(null);
      const [currencyConverting, setCurrencyConverting] = useState(false);
      
      // Translation helper
      const t = (key) => translations[language][key] || key;
      
      // Update AI greeting when language changes
      useEffect(() => {
        const greeting = t('aiGreeting');
        setAiMessages([{ from: 'ai', text: greeting }]);
      }, [language]);

      // Password visibility states
      const [showPassword, setShowPassword] = useState(false);
      const [showCurrentPassword, setShowCurrentPassword] = useState(false);
      const [showNewPassword, setShowNewPassword] = useState(false);
      const [showConfirmPassword, setShowConfirmPassword] = useState(false);
      const [showResetPassword, setShowResetPassword] = useState(false);

      useEffect(() => {
        const savedTheme = localStorage.getItem(THEME_KEY);
        if (savedTheme) {
          setTheme(savedTheme);
          document.documentElement.setAttribute('data-theme', savedTheme);
        }
        const savedLang = localStorage.getItem(LANG_KEY);
        if (savedLang) {
          setLanguage(savedLang);
        }
        const savedCurrency = localStorage.getItem(CURRENCY_KEY);
        if (savedCurrency && currencies[savedCurrency]) {
          setCurrency(savedCurrency);
        }
        const savedToken = localStorage.getItem(TOKEN_KEY);
        if (savedToken) {
          setToken(savedToken);
          loadUser(savedToken);
        } else {
          setLoading(false);
        }
      }, []);

      // Load support stats when admin panel opens
      useEffect(() => {
        if (showAdminPanel && isAdminVerified && adminKey) {
          loadSupportStats();
        }
      }, [showAdminPanel, isAdminVerified, adminKey]);

      const loadUser = async (t) => {
        try {
          const res = await fetch('/api/user/profile', { headers: { 'Authorization': `Bearer ${t}` } });
          if (res.ok) {
            const userData = await res.json();
            setUser(userData);
            if (userData.language) {
              setLanguage(userData.language);
              localStorage.setItem(LANG_KEY, userData.language);
            }
            if (userData.currency && currencies[userData.currency]) {
              setCurrency(userData.currency);
              localStorage.setItem(CURRENCY_KEY, userData.currency);
            }
            setShowLanding(false);
            loadData(t, userData.language || language);
          } else {
            throw new Error('Invalid token');
          }
        } catch (e) {
          localStorage.removeItem(TOKEN_KEY);
          setToken(null);
        }
        setLoading(false);
      };
      
      const loadData = async (t, lang = language) => {
        try {
          const [branchesRes, purchasesRes, salesRes, reviewsRes, faqRes, ticketsRes] = await Promise.all([
            fetch('/api/branches', { headers: { 'Authorization': `Bearer ${t}` } }),
            fetch('/api/purchases', { headers: { 'Authorization': `Bearer ${t}` } }),
            fetch('/api/sales', { headers: { 'Authorization': `Bearer ${t}` } }),
            fetch('/api/reviews'),
            fetch(`/api/faq?lang=${lang}`, { headers: { 'Authorization': `Bearer ${t}` } }),
            fetch('/api/tickets', { headers: { 'Authorization': `Bearer ${t}` } })
          ]);
          const branchesData = await branchesRes.json();
          const purchasesData = await purchasesRes.json();
          const salesData = await salesRes.json();
          const reviewsData = await reviewsRes.json();
          const faqData = await faqRes.json();
          const ticketsData = await ticketsRes.json();
          
          setBranches(branchesData);
          setPurchases(purchasesData);
          setSales(salesData);
          if (reviewsData && reviewsData.length > 0) setReviews(reviewsData);
          setFaq(faqData);
          setTickets(ticketsData);
          if (branchesData.length > 0 && !currentBranchId) setCurrentBranchId(branchesData[0].id);
        } catch (e) {
          console.error('Load data error:', e);
        }
      };
      
      const handleChangeLanguage = async (newLang) => {
        setLanguage(newLang);
        localStorage.setItem(LANG_KEY, newLang);
        if (token) {
          try {
            await fetch('/api/user/language', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
              body: JSON.stringify({ language: newLang })
            });
            // Reload FAQ with new language
            const faqRes = await fetch(`/api/faq?lang=${newLang}`, { headers: { 'Authorization': `Bearer ${token}` } });
            const faqData = await faqRes.json();
            setFaq(faqData);
          } catch (e) {
            console.error('Change language error:', e);
          }
        }
      };

      const toggleTheme = () => {
        const newTheme = theme === 'light' ? 'dark' : 'light';
        setTheme(newTheme);
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem(THEME_KEY, newTheme);
      };

      const handleLogin = async () => {
        setAuthError('');
        setAuthLoading(true);
        try {
          const res = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ login: loginInput, password: passwordInput })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          localStorage.setItem(TOKEN_KEY, data.token);
          setToken(data.token);
          setUser(data.user);
          if (data.user.language) {
            setLanguage(data.user.language);
            localStorage.setItem(LANG_KEY, data.user.language);
          }
          if (data.user.currency) {
            setCurrency(data.user.currency);
            localStorage.setItem(CURRENCY_KEY, data.user.currency);
          }
          setShowLanding(false);
          setLoginInput('');
          setPasswordInput('');
          loadData(data.token, data.user.language || language);
        } catch (e) {
          setAuthError(e.message);
        }
        setAuthLoading(false);
      };

      const handleRegister = async () => {
        setAuthError('');
        if (!emailInput.trim()) {
          setAuthError(t('emailRequiredError'));
          return;
        }
        setAuthLoading(true);
        try {
          const res = await fetch('/api/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: userName, login: loginInput, password: passwordInput, email: emailInput })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          localStorage.setItem(TOKEN_KEY, data.token);
          setToken(data.token);
          setUser(data.user);
          if (data.user.language) {
            setLanguage(data.user.language);
            localStorage.setItem(LANG_KEY, data.user.language);
          }
          if (data.user.currency) {
            setCurrency(data.user.currency);
            localStorage.setItem(CURRENCY_KEY, data.user.currency);
          }
          setShowLanding(false);
          setLoginInput('');
          setPasswordInput('');
          setUserName('');
          setEmailInput('');
          loadData(data.token, data.user.language || language);
        } catch (e) {
          setAuthError(e.message);
        }
        setAuthLoading(false);
      };

      const handleForgotPassword = async () => {
        setAuthError('');
        setAuthSuccess('');
        if (!resetEmail.trim()) {
          setAuthError('–í–≤–µ–¥–∏—Ç–µ email');
          return;
        }
        setAuthLoading(true);
        try {
          console.log('Sending forgot password request...');
          const res = await fetch('/api/auth/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: resetEmail })
          });
          console.log('Response status:', res.status);
          const data = await res.json();
          console.log('Response data:', data);
          if (!res.ok) throw new Error(data.error);
          setAuthSuccess(data.message);
          setResetStep(2);
        } catch (e) {
          console.error('Forgot password error:', e);
          setAuthError(e.message);
        } finally {
          setAuthLoading(false);
        }
      };

      const handleVerifyCode = async () => {
        setAuthError('');
        setAuthLoading(true);
        try {
          const res = await fetch('/api/auth/verify-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: resetEmail, code: resetCode })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          setResetStep(3);
          setAuthSuccess('');
        } catch (e) {
          setAuthError(e.message);
        }
        setAuthLoading(false);
      };

      const handleResetPassword = async () => {
        setAuthError('');
        if (!newResetPassword || newResetPassword.length < 4) {
          setAuthError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞');
          return;
        }
        if (newResetPassword !== confirmPassword) {
          setAuthError('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
          return;
        }
        setAuthLoading(true);
        try {
          const res = await fetch('/api/auth/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: resetEmail, code: resetCode, newPassword: newResetPassword })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          setAuthSuccess(data.message);
          setTimeout(() => {
            setShowForgotPassword(false);
            setResetStep(1);
            setResetEmail('');
            setResetCode('');
            setNewResetPassword('');
            setAuthSuccess('');
          }, 2000);
        } catch (e) {
          setAuthError(e.message);
        }
        setAuthLoading(false);
      };

      const handleChangePassword = async () => {
        setPasswordError('');
        setPasswordSuccess('');
        if (!currentPassword || !newPassword || !confirmPassword) {
          setPasswordError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
          return;
        }
        if (newPassword !== confirmPassword) {
          setPasswordError('–ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
          return;
        }
        if (newPassword.length < 4) {
          setPasswordError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞');
          return;
        }
        try {
          const res = await fetch('/api/auth/change-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ currentPassword, newPassword })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          setPasswordSuccess(data.message);
          setCurrentPassword('');
          setNewPassword('');
          setConfirmPassword('');
        } catch (e) {
          setPasswordError(e.message);
        }
      };

      const handleLogout = () => {
        localStorage.removeItem(TOKEN_KEY);
        setToken(null);
        setUser(null);
        setPurchases([]);
        setSales([]);
        setBranches([]);
        setCurrentBranchId('');
        setSidebarOpen(false);
        setShowLanding(true);
      };

      const handleUpdateEmail = async () => {
        try {
          const res = await fetch('/api/user/profile', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ email: emailInput })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          setUser({ ...user, email: data.email });
          alert('Email –æ–±–Ω–æ–≤–ª–µ–Ω');
        } catch (e) {
          alert(e.message);
        }
      };

      const handlePhotoUpload = (e, setPhoto) => {
        const file = e.target.files[0];
        if (!file) return;
        if (file.size > 5 * 1024 * 1024) {
          alert('–§–æ—Ç–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä 5MB');
          return;
        }
        const img = new Image();
        const url = URL.createObjectURL(file);
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const maxWidth = 400, maxHeight = 400;
          let width = img.width, height = img.height;
          if (width > height) {
            if (width > maxWidth) { height = Math.round((height * maxWidth) / width); width = maxWidth; }
          } else {
            if (height > maxHeight) { width = Math.round((width * maxHeight) / height); height = maxHeight; }
          }
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          const base64 = canvas.toDataURL('image/jpeg', 0.8);
          setPhoto(base64);
          URL.revokeObjectURL(url);
        };
        img.src = url;
      };

      const createBranch = async () => {
        if (!newBranchName.trim()) return;
        try {
          const res = await fetch('/api/branches', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ name: newBranchName })
          });
          const newBranch = await res.json();
          if (!res.ok) throw new Error(newBranch.error);
          setBranches([...branches, newBranch]);
          setCurrentBranchId(newBranch.id);
          setNewBranchName('');
          setShowNewBranchForm(false);
        } catch (e) {
          alert(e.message);
        }
      };

      const deleteBranch = async (branchId) => {
        if (branches.length <= 1) {
          alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ç–∫—É');
          return;
        }
        if (confirm('–£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É? –í—Å–µ –∑–∞–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ –≤ —ç—Ç–æ–π –≤–µ—Ç–∫–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
          try {
            const res = await fetch(`/api/branches/${branchId}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${token}` }
            });
            if (!res.ok) throw new Error('Error');
            setBranches(branches.filter(b => b.id !== branchId));
            setPurchases(purchases.filter(p => p.branchId !== branchId));
            setSales(sales.filter(s => s.branchId !== branchId));
            if (currentBranchId === branchId) {
              const remaining = branches.filter(b => b.id !== branchId);
              setCurrentBranchId(remaining[0]?.id || '');
            }
          } catch (e) {
            alert(e.message);
          }
        }
      };

      const addPurchase = async () => {
        if (!purchaseName || !purchaseQty || !purchasePrice || !currentBranchId) return;
        try {
          const res = await fetch('/api/purchases', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({
              productName: purchaseName.trim(),
              quantity: parseInt(purchaseQty),
              price: parseFloat(purchasePrice),
              date: purchaseDate,
              branchId: currentBranchId,
              photo: purchasePhoto || undefined,
              notes: purchaseNotes.trim() || undefined
            })
          });
          const newPurchase = await res.json();
          if (!res.ok) throw new Error(newPurchase.error);
          setPurchases([newPurchase, ...purchases]);
          setPurchaseName('');
          setPurchaseQty('1');
          setPurchasePrice('');
          setPurchasePhoto('');
          setPurchaseNotes('');
        } catch (e) {
          alert(e.message);
        }
      };

      const addSale = async () => {
        if (!saleProduct || !saleQty || !salePrice || !currentBranchId) return;
        try {
          const res = await fetch('/api/sales', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({
              productName: saleProduct,
              quantity: parseInt(saleQty),
              salePrice: parseFloat(salePrice),
              date: saleDate,
              branchId: currentBranchId,
              notes: saleNotes.trim() || undefined
            })
          });
          const newSale = await res.json();
          if (!res.ok) throw new Error(newSale.error);
          setSales([newSale, ...sales]);
          await loadData(token);
          setSaleProduct('');
          setSaleQty('1');
          setSalePrice('');
          setSaleNotes('');
        } catch (e) {
          alert(e.message);
        }
      };

      const openQuickSale = (productName) => {
        const relevantPurchases = purchases.filter(p => 
          p.branchId === currentBranchId && 
          p.productName === productName && 
          p.remainingQty > 0
        );
        const totalRemaining = relevantPurchases.reduce((sum, p) => sum + p.remainingQty, 0);
        if (totalRemaining <= 0) {
          alert('–¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è!');
          return;
        }
        const firstPurchase = relevantPurchases[0];
        setQuickSaleProduct(productName);
        setQuickSalePhoto(firstPurchase?.photo || '');
        setQuickSalePurchasePrice(firstPurchase?.price.toString() || '0');
        setSalePrice('');
        setSaleQty('1');
        setSaleNotes('');
        setSaleDate(new Date().toISOString().split('T')[0]);
        setShowQuickSale(true);
      };

      const addQuickSale = async () => {
        if (!quickSaleProduct || !saleQty || !salePrice) return;
        try {
          const res = await fetch('/api/sales', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({
              productName: quickSaleProduct,
              quantity: parseInt(saleQty),
              salePrice: parseFloat(salePrice),
              date: saleDate,
              branchId: currentBranchId,
              notes: saleNotes.trim() || undefined
            })
          });
          if (!res.ok) {
            const err = await res.json();
            throw new Error(err.error);
          }
          await loadData(token);
          setShowQuickSale(false);
          setQuickSaleProduct('');
          setQuickSalePhoto('');
          setQuickSalePurchasePrice('');
          setSalePrice('');
          setSaleQty('1');
          setSaleNotes('');
        } catch (e) {
          alert(e.message);
        }
      };

      const deletePurchase = async (id) => {
        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–∫—É–ø–∫—É?')) {
          try {
            await fetch(`/api/purchases/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${token}` }
            });
            setPurchases(purchases.filter(p => p.id !== id));
          } catch (e) {
            alert(e.message);
          }
        }
      };

      const deleteSale = async (id) => {
        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–æ–¥–∞–∂—É?')) {
          try {
            await fetch(`/api/sales/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${token}` }
            });
            setSales(sales.filter(s => s.id !== id));
          } catch (e) {
            alert(e.message);
          }
        }
      };

      const savePurchaseNotes = async (id) => {
        try {
          await fetch(`/api/purchases/${id}/notes`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ notes: editNotes })
          });
          setPurchases(purchases.map(p => p.id === id ? { ...p, notes: editNotes.trim() || undefined } : p));
          setEditingPurchaseId('');
          setEditNotes('');
        } catch (e) {
          alert(e.message);
        }
      };

      const saveSaleNotes = async (id) => {
        try {
          await fetch(`/api/sales/${id}/notes`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ notes: editNotes })
          });
          setSales(sales.map(s => s.id === id ? { ...s, notes: editNotes.trim() || undefined } : s));
          setEditingSaleId('');
          setEditNotes('');
        } catch (e) {
          alert(e.message);
        }
      };

      const handleAddReview = async () => {
        if (newReviewRating === 0) {
          alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥');
          return;
        }
        if (!newReviewText.trim()) {
          alert('–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤');
          return;
        }
        try {
          const res = await fetch('/api/reviews', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ rating: newReviewRating, text: newReviewText.trim() })
          });
          const review = await res.json();
          if (!res.ok) throw new Error(review.error);
          setReviews([review, ...reviews]);
          setNewReviewRating(0);
          setNewReviewText('');
        } catch (e) {
          alert(e.message);
        }
      };

      const formatCurrency = (amount) => {
        const curr = currencies[currency];
        return new Intl.NumberFormat(curr.locale, { style: 'currency', currency: curr.code }).format(amount || 0);
      };
      
      const handleChangeCurrency = async (newCurrency) => {
        if (newCurrency === currency) return;
        
        // Show confirmation modal with exchange rate
        try {
          const res = await fetch(`/api/exchange-rate?from=${currency}&to=${newCurrency}`, {
            headers: { 'Authorization': `Bearer ${token}` }
          });
          const data = await res.json();
          
          if (res.ok) {
            setExchangeRate(data);
            setPendingCurrency(newCurrency);
            setShowCurrencyConfirm(true);
          } else {
            alert(data.error || 'Failed to get exchange rate');
          }
        } catch (e) {
          console.error('Get exchange rate error:', e);
          alert('Failed to get exchange rate');
        }
      };
      
      const confirmCurrencyChange = async () => {
        if (!pendingCurrency || !exchangeRate) return;
        
        setCurrencyConverting(true);
        try {
          const res = await fetch('/api/user/currency', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ currency: pendingCurrency, confirm: true })
          });
          const data = await res.json();
          
          if (res.ok) {
            setCurrency(pendingCurrency);
            localStorage.setItem(CURRENCY_KEY, pendingCurrency);
            // Reload data to show converted values
            await loadData(token);
            setShowCurrencyConfirm(false);
            setPendingCurrency(null);
            setExchangeRate(null);
            alert(`${t('currencyChanged')} ${data.purchasesConverted} ${t('purchasesConverted')}, ${data.salesConverted} ${t('salesConverted')}.`);
          } else {
            alert(data.error || 'Failed to change currency');
          }
        } catch (e) {
          console.error('Change currency error:', e);
          alert('Failed to change currency');
        }
        setCurrencyConverting(false);
      };
      
      const cancelCurrencyChange = () => {
        setShowCurrencyConfirm(false);
        setPendingCurrency(null);
        setExchangeRate(null);
      };

      // Support system functions
      const handleCreateTicket = async () => {
        if (!ticketSubject.trim() || !ticketMessage.trim()) {
          alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–º—É –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ');
          return;
        }
        try {
          const res = await fetch('/api/tickets', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ subject: ticketSubject, message: ticketMessage })
          });
          const newTicket = await res.json();
          if (!res.ok) throw new Error(newTicket.error);
          setTickets([newTicket, ...tickets]);
          setTicketSubject('');
          setTicketMessage('');
          setShowNewTicket(false);
          alert('–û–±—Ä–∞—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ! –ú—ã –æ—Ç–≤–µ—Ç–∏–º –≤–∞–º soon.');
        } catch (e) {
          alert(e.message);
        }
      };

      const handleSendReply = async () => {
        if (!replyMessage.trim() || !selectedTicket) return;
        try {
          const res = await fetch(`/api/tickets/${selectedTicket.id}/messages`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ text: replyMessage })
          });
          const updatedTicket = await res.json();
          if (!res.ok) throw new Error(updatedTicket.error);
          setTickets(tickets.map(t => t.id === updatedTicket.id ? updatedTicket : t));
          setSelectedTicket(updatedTicket);
          setReplyMessage('');
        } catch (e) {
          alert(e.message);
        }
      };

      const openCloseTicketModal = (ticket) => {
        setTicketToClose(ticket);
        setSupportRating(0);
        setShowRatingModal(true);
      };

      const closeUserTicket = async () => {
        if (!ticketToClose) return;
        try {
          const res = await fetch(`/api/tickets/${ticketToClose.id}/close`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ rating: supportRating })
          });
          const updatedTicket = await res.json();
          if (!res.ok) throw new Error(updatedTicket.error);
          setTickets(tickets.map(t => t.id === updatedTicket.id ? updatedTicket : t));
          if (selectedTicket && selectedTicket.id === ticketToClose.id) {
            setSelectedTicket(updatedTicket);
          }
          setShowRatingModal(false);
          setTicketToClose(null);
          setSupportRating(0);
          alert(t('ticketClosed'));
        } catch (e) {
          alert(e.message);
        }
      };

      const handleAISend = async () => {
        if (!aiInput.trim()) return;
        const userMsg = aiInput.trim();
        setAiMessages([...aiMessages, { from: 'user', text: userMsg }]);
        setAiInput('');
        setAiLoading(true);
        try {
          const res = await fetch('/api/ai/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userMsg, context: aiMessages.slice(-5) })
          });
          const data = await res.json();
          setAiMessages(prev => [...prev, { from: 'ai', text: data.response }]);
        } catch (e) {
          setAiMessages(prev => [...prev, { from: 'ai', text: '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' }]);
        }
        setAiLoading(false);
      };

      // Admin panel functions
      const verifyAdminKey = async () => {
        if (!adminKeyInput.trim()) return;
        try {
          const res = await fetch('/api/admin/tickets', {
            headers: { 'x-admin-key': adminKeyInput }
          });
          if (res.ok) {
            const ticketsData = await res.json();
            setAllTickets(ticketsData);
            setIsAdminVerified(true);
            setAdminKey(adminKeyInput);
            setAdminKeyInput('');
          } else {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
          }
        } catch (e) {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–∞');
        }
      };

      const loadAllTickets = async () => {
        try {
          const res = await fetch('/api/admin/tickets', {
            headers: { 'x-admin-key': adminKey }
          });
          if (res.ok) {
            const ticketsData = await res.json();
            setAllTickets(ticketsData);
          }
        } catch (e) {
          console.error('Load tickets error:', e);
        }
      };

      const loadSupportStats = async () => {
        try {
          const res = await fetch('/api/admin/support-stats', {
            headers: { 'x-admin-key': adminKey }
          });
          if (res.ok) {
            const stats = await res.json();
            setSupportStats(stats);
          }
        } catch (e) {
          console.error('Load support stats error:', e);
        }
      };

      const sendAdminReply = async () => {
        if (!adminReplyMessage.trim() || !selectedAdminTicket) return;
        try {
          const res = await fetch(`/api/tickets/${selectedAdminTicket.id}/reply`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-admin-key': adminKey },
            body: JSON.stringify({ text: adminReplyMessage })
          });
          if (!res.ok) {
            const err = await res.json();
            throw new Error(err.error);
          }
          const updatedTicket = await res.json();
          // Update both tickets list and selected ticket immediately
          const updatedTickets = allTickets.map(t => t.id === updatedTicket.id ? updatedTicket : t);
          setAllTickets(updatedTickets);
          setSelectedAdminTicket(updatedTicket);
          setAdminReplyMessage('');
          // Also refresh stats
          loadSupportStats();
        } catch (e) {
          alert(e.message);
        }
      };

      const closeAdminTicket = async (ticketId) => {
        if (!confirm(t('confirmCloseTicket'))) return;
        try {
          const res = await fetch(`/api/tickets/${ticketId}/close`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-admin-key': adminKey }
          });
          if (!res.ok) {
            const err = await res.json();
            throw new Error(err.error);
          }
          const updatedTicket = await res.json();
          // Update both tickets list and selected ticket immediately
          const updatedTickets = allTickets.map(t => t.id === updatedTicket.id ? updatedTicket : t);
          setAllTickets(updatedTickets);
          if (selectedAdminTicket && selectedAdminTicket.id === ticketId) {
            setSelectedAdminTicket(updatedTicket);
          }
          // Also refresh stats
          loadSupportStats();
        } catch (e) {
          alert(e.message);
        }
      };

      const getMonthlySummary = () => {
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        
        const monthlyPurchases = purchases.filter(p => {
          const d = new Date(p.date);
          return d.getMonth() === currentMonth && d.getFullYear() === currentYear && p.branchId === currentBranchId;
        });
        
        const monthlySales = sales.filter(s => {
          const d = new Date(s.date);
          return d.getMonth() === currentMonth && d.getFullYear() === currentYear && s.branchId === currentBranchId;
        });
        
        const productSummary = {};
        
        monthlyPurchases.forEach(p => {
          if (!productSummary[p.productName]) {
            productSummary[p.productName] = { purchased: 0, sold: 0, purchaseAmount: 0, saleAmount: 0, profit: 0 };
          }
          productSummary[p.productName].purchased += p.quantity;
          productSummary[p.productName].purchaseAmount += p.total;
        });
        
        monthlySales.forEach(s => {
          if (!productSummary[s.productName]) {
            productSummary[s.productName] = { purchased: 0, sold: 0, purchaseAmount: 0, saleAmount: 0, profit: 0 };
          }
          productSummary[s.productName].sold += s.quantity;
          productSummary[s.productName].saleAmount += s.totalRevenue;
          productSummary[s.productName].profit += s.profit;
        });
        
        return { monthlyPurchases, monthlySales, productSummary };
      };

      const getAvailableProducts = () => {
        const productMap = {};
        purchases.filter(p => p.branchId === currentBranchId).forEach(p => {
          if (!productMap[p.productName]) {
            productMap[p.productName] = { name: p.productName, photo: p.photo, remaining: 0 };
          }
          productMap[p.productName].remaining += p.remainingQty;
        });
        return Object.values(productMap).filter(p => p.remaining > 0);
      };

      if (loading) {
        return (
          <div className="loading">
            <div>
              <div className="loading-icon">üìä</div>
              <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
          </div>
        );
      }


      // Landing Page
      if (showLanding && !token) {
        return (
          <div className="landing-page">
            <div className="landing-hero" style={{ position: 'relative' }}>
              {/* Language selector */}
              <div style={{ position: 'absolute', top: '20px', right: '20px', display: 'flex', gap: '8px' }}>
                <button 
                  onClick={() => handleChangeLanguage('ru')}
                  style={{ 
                    padding: '8px 12px', 
                    borderRadius: '6px', 
                    border: 'none',
                    background: language === 'ru' ? 'white' : 'rgba(255,255,255,0.2)', 
                    color: language === 'ru' ? '#667eea' : 'white',
                    cursor: 'pointer',
                    fontWeight: '600'
                  }}
                >
                  üá∑üá∫ RU
                </button>
                <button 
                  onClick={() => handleChangeLanguage('en')}
                  style={{ 
                    padding: '8px 12px', 
                    borderRadius: '6px', 
                    border: 'none',
                    background: language === 'en' ? 'white' : 'rgba(255,255,255,0.2)', 
                    color: language === 'en' ? '#667eea' : 'white',
                    cursor: 'pointer',
                    fontWeight: '600'
                  }}
                >
                  üá¨üáß EN
                </button>
              </div>
              <h1>{t('appName')}</h1>
              <p>{t('tagline')}</p>
              <div>
                <button className="landing-btn" onClick={() => setShowLanding(false)}>{t('startFree')}</button>
                <button className="landing-btn landing-btn-outline" onClick={() => { setShowLanding(false); setAuthMode('login'); }}>{t('login')}</button>
              </div>
              <div className="landing-stats">
                <div className="landing-stat">
                  <div className="landing-stat-value">15,000+</div>
                  <div className="landing-stat-label">{t('users')}</div>
                </div>
                <div className="landing-stat">
                  <div className="landing-stat-value">500+</div>
                  <div className="landing-stat-label">{t('reviews')}</div>
                </div>
                <div className="landing-stat">
                  <div className="landing-stat-value">‚Ç¨2M+</div>
                  <div className="landing-stat-label">{t('salesTracked')}</div>
                </div>
              </div>
            </div>

            <div className="landing-section">
              <h2>{t('features')}</h2>
              <div className="features-grid">
                <div className="feature-card">
                  <div className="feature-icon">üìä</div>
                  <h3>{t('autoProfit')}</h3>
                  <p>{t('autoProfitDesc')}</p>
                </div>
                <div className="feature-card">
                  <div className="feature-icon">üì∏</div>
                  <h3>{t('photos')}</h3>
                  <p>{t('photosDesc')}</p>
                </div>
                <div className="feature-card">
                  <div className="feature-icon">üìù</div>
                  <h3>{t('notes')}</h3>
                  <p>{t('notesDesc')}</p>
                </div>
                <div className="feature-card">
                  <div className="feature-icon">üè∑Ô∏è</div>
                  <h3>{t('categories')}</h3>
                  <p>{t('categoriesDesc')}</p>
                </div>
                <div className="feature-card">
                  <div className="feature-icon">üì¶</div>
                  <h3>{t('inventory')}</h3>
                  <p>{t('inventoryDesc')}</p>
                </div>
                <div className="feature-card">
                  <div className="feature-icon">üìÖ</div>
                  <h3>{t('monthlySummary')}</h3>
                  <p>{t('monthlySummaryDesc')}</p>
                </div>
              </div>
            </div>

            <div className="landing-section" style={{ background: 'var(--bg-secondary)' }}>
              <h2>{t('howItWorks')}</h2>
              <div className="screenshots-grid">
                <div className="screenshot-card">
                  <div className="screenshot-img">üì•</div>
                  <div className="screenshot-content">
                    <h3>1. {t('step1')}</h3>
                    <p>{t('step1Desc')}</p>
                  </div>
                </div>
                <div className="screenshot-card">
                  <div className="screenshot-img">üì§</div>
                  <div className="screenshot-content">
                    <h3>2. {t('step2')}</h3>
                    <p>{t('step2Desc')}</p>
                  </div>
                </div>
                <div className="screenshot-card">
                  <div className="screenshot-img">üí∞</div>
                  <div className="screenshot-content">
                    <h3>3. {t('step3')}</h3>
                    <p>{t('step3Desc')}</p>
                  </div>
                </div>
              </div>
            </div>

            <div className="landing-section reviews-section">
              <h2>{t('userReviews')}</h2>
              <div className="reviews-grid">
                {reviews.slice(0, 6).map(review => (
                  <div key={review.id} className="review-card">
                    <div className="review-header">
                      <div className="review-avatar">{review.name.charAt(0)}</div>
                      <div className="review-info">
                        <h4>{review.name}</h4>
                        <div className="review-stars">{'‚òÖ'.repeat(review.rating)}{'‚òÜ'.repeat(5 - review.rating)}</div>
                      </div>
                    </div>
                    <p className="review-text">{review.text}</p>
                  </div>
                ))}
              </div>
              
              {token && (
                <div className="review-form">
                  <h3>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
                  <div className="star-rating">
                    {[1, 2, 3, 4, 5].map(star => (
                      <button key={star} className={`star-btn ${star <= newReviewRating ? 'active' : ''}`} onClick={() => setNewReviewRating(star)}>‚òÖ</button>
                    ))}
                  </div>
                  <div className="form-group">
                    <textarea placeholder={t('writeReview')} value={newReviewText} onChange={(e) => setNewReviewText(e.target.value)} rows={3} />
                  </div>
                  <button className="btn btn-primary" onClick={handleAddReview}>{t('sendReview')}</button>
                </div>
              )}
              
              {!token && (
                <div style={{ textAlign: 'center', marginTop: '32px' }}>
                  <button className="landing-btn" onClick={() => setShowLanding(false)}>{t('loginToReview')}</button>
                </div>
              )}
            </div>

            <div className="landing-footer">
              <p>¬© 2024 ProfitTrack. {t('footer')}</p>
            </div>
          </div>
        );
      }

      // Auth Screen
      if (!token) {
        return (
          <div className="auth-container">
            <div className="auth-card">
              {/* Language selector for auth */}
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '8px', marginBottom: '16px' }}>
                <button 
                  onClick={() => handleChangeLanguage('ru')}
                  style={{ 
                    padding: '6px 10px', 
                    borderRadius: '6px', 
                    border: '1px solid var(--border-color)',
                    background: language === 'ru' ? '#3b82f6' : 'var(--bg-primary)', 
                    color: language === 'ru' ? 'white' : 'var(--text-primary)',
                    cursor: 'pointer',
                    fontSize: '12px'
                  }}
                >
                  üá∑üá∫ RU
                </button>
                <button 
                  onClick={() => handleChangeLanguage('en')}
                  style={{ 
                    padding: '6px 10px', 
                    borderRadius: '6px', 
                    border: '1px solid var(--border-color)',
                    background: language === 'en' ? '#3b82f6' : 'var(--bg-primary)', 
                    color: language === 'en' ? 'white' : 'var(--text-primary)',
                    cursor: 'pointer',
                    fontSize: '12px'
                  }}
                >
                  üá¨üáß EN
                </button>
              </div>
              <div className="auth-header">
                <h1>ProfitTrack</h1>
                <p>{t('authTitle')}</p>
              </div>
              <div className="auth-form">
                {showForgotPassword ? (
                  <>
                    <h2 style={{ marginBottom: '16px', color: 'var(--text-primary)' }}>{t('resetPassword')}</h2>
                    {resetStep === 1 && (
                      <>
                        <div className="form-group">
                          <label>Email <span className="required">*</span></label>
                          <input type="email" placeholder="your@email.com" value={resetEmail} onChange={(e) => setResetEmail(e.target.value)} />
                        </div>
                        {authError && <div className="auth-error">{authError}</div>}
                        {authSuccess && <div className="auth-success">{authSuccess}</div>}
                        <button className="auth-btn" onClick={handleForgotPassword} disabled={authLoading}>
                          {authLoading ? (language === 'ru' ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : 'Sending...') : (language === 'ru' ? '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥' : 'Send Code')}
                        </button>
                      </>
                    )}
                    {resetStep === 2 && (
                      <>
                        <div className="info-box">{t('resetCodeSent')} {resetEmail}. {t('checkSpam')}</div>
                        <div className="form-group">
                          <label>{t('resetCode')}</label>
                          <input type="text" placeholder={t('resetCodePlaceholder')} value={resetCode} onChange={(e) => setResetCode(e.target.value)} />
                        </div>
                        {authError && <div className="auth-error">{authError}</div>}
                        <button className="auth-btn" onClick={handleVerifyCode} disabled={authLoading}>
                          {authLoading ? (language === 'ru' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : 'Verifying...') : (language === 'ru' ? '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å' : 'Verify')}
                        </button>
                      </>
                    )}
                    {resetStep === 3 && (
                      <>
                        <div className="form-group">
                          <label>{t('newPassword')}</label>
                          <div className="password-input-wrapper">
                            <input type={showResetPassword ? 'text' : 'password'} placeholder={t('passwordMin')} value={newResetPassword} onChange={(e) => setNewResetPassword(e.target.value)} />
                            <button type="button" className="password-toggle" onClick={() => setShowResetPassword(!showResetPassword)}>
                              {showResetPassword ? 'üôà' : 'üëÅÔ∏è'}
                            </button>
                          </div>
                        </div>
                        <div className="form-group">
                          <label>{t('confirmPassword')}</label>
                          <div className="password-input-wrapper">
                            <input type={showResetPassword ? 'text' : 'password'} placeholder={t('confirmPasswordPlaceholder')} value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} />
                          </div>
                        </div>
                        {authError && <div className="auth-error">{authError}</div>}
                        {authSuccess && <div className="auth-success">{authSuccess}</div>}
                        <button className="auth-btn" onClick={handleResetPassword} disabled={authLoading || newResetPassword !== confirmPassword}>
                          {authLoading ? (language === 'ru' ? '–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è...' : 'Changing...') : t('changePassword')}
                        </button>
                      </>
                    )}
                    <div className="back-to-login">
                      <button onClick={() => { setShowForgotPassword(false); setResetStep(1); setAuthError(''); setAuthSuccess(''); }}>{t('backToLogin')}</button>
                    </div>
                  </>
                ) : (
                  <>
                    <div className="auth-tabs">
                      <button className={`auth-tab ${authMode === 'login' ? 'active' : ''}`} onClick={() => setAuthMode('login')}>{t('login')}</button>
                      <button className={`auth-tab ${authMode === 'register' ? 'active' : ''}`} onClick={() => setAuthMode('register')}>{t('register')}</button>
                    </div>
                    
                    {authMode === 'register' && (
                      <div className="form-group">
                        <label>{t('yourName')}</label>
                        <input type="text" placeholder={t('namePlaceholder')} value={userName} onChange={(e) => setUserName(e.target.value)} />
                      </div>
                    )}
                    
                    <div className="form-group">
                      <label>{t('loginOrEmail')}</label>
                      <input type="text" placeholder={t('loginPlaceholder')} value={loginInput} onChange={(e) => setLoginInput(e.target.value)} />
                    </div>
                    
                    {authMode === 'register' && (
                      <div className="form-group">
                        <label>Email <span className="required">*</span></label>
                        <input type="email" placeholder="your@email.com" value={emailInput} onChange={(e) => setEmailInput(e.target.value)} />
                        <small style={{ color: 'var(--text-secondary)', fontSize: '12px' }}>{t('emailRequired')}</small>
                      </div>
                    )}
                    
                    <div className="form-group">
                      <label>{t('password')}</label>
                      <div className="password-input-wrapper">
                        <input type={showPassword ? 'text' : 'password'} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} />
                        <button type="button" className="password-toggle" onClick={() => setShowPassword(!showPassword)}>
                          {showPassword ? 'üôà' : 'üëÅÔ∏è'}
                        </button>
                      </div>
                    </div>
                    
                    {authError && <div className="auth-error">{authError}</div>}
                    
                    <button className="auth-btn" onClick={authMode === 'login' ? handleLogin : handleRegister} disabled={authLoading}>
                      {authLoading ? (language === 'ru' ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : 'Loading...') : (authMode === 'login' ? t('login') : t('register'))}
                    </button>
                    
                    {authMode === 'login' && (
                      <div className="forgot-password">
                        <button onClick={() => { setShowForgotPassword(true); setAuthError(''); }}>{t('forgotPassword')}</button>
                      </div>
                    )}
                    
                    <div className="back-to-login">
                      <button onClick={() => setShowLanding(true)}>{t('backToHome')}</button>
                    </div>
                  </>
                )}
              </div>
            </div>
          </div>
        );
      }

      const availableProducts = getAvailableProducts();
      const { monthlyPurchases, monthlySales, productSummary } = getMonthlySummary();

      const totalPurchases = purchases.filter(p => p.branchId === currentBranchId).reduce((sum, p) => sum + p.total, 0);
      const branchSales = sales.filter(s => s.branchId === currentBranchId);
      const totalSales = branchSales.reduce((sum, s) => sum + s.totalRevenue, 0);
      const totalProfit = branchSales.reduce((sum, s) => sum + s.profit, 0);

      return (
        <div>
          <header className="app-header">
            <div className="app-header-content">
              <div className="header-left">
                <button className="menu-btn" onClick={() => setSidebarOpen(true)}>‚ò∞</button>
                <div className="logo">
                  <span className="logo-icon">üìä</span>
                  <div className="logo-text">
                    <h1>ProfitTrack</h1>
                  </div>
                </div>
              </div>
              <div className="user-info">
                <span style={{ color: 'var(--text-secondary)' }}>üë§ {user?.name}</span>
                <button className="logout-btn" onClick={handleLogout}>–í—ã–π—Ç–∏</button>
              </div>
            </div>
          </header>

          {sidebarOpen && <div className="sidebar-overlay" onClick={() => setSidebarOpen(false)} />}
          <div className={`sidebar ${sidebarOpen ? 'open' : ''}`}>
            <div className="sidebar-header">
              <h2>–ú–µ–Ω—é</h2>
              <button className="close-sidebar" onClick={() => setSidebarOpen(false)}>‚úï</button>
            </div>
            <div className="sidebar-menu">
              <button className="sidebar-item" onClick={() => { setShowProfile(true); setSidebarOpen(false); }}>üë§ {t('profile')}</button>
              <button className="sidebar-item" onClick={() => { setActiveTab('add'); setSidebarOpen(false); setShowSupport(false); }}>‚ûï {t('add')}</button>
              <button className="sidebar-item" onClick={() => { setActiveTab('history'); setSidebarOpen(false); setShowSupport(false); }}>üìã {t('history')}</button>
              <button className="sidebar-item" onClick={() => { setActiveTab('summary'); setSidebarOpen(false); setShowSupport(false); }}>üìä {t('summary')}</button>
              <button className="sidebar-item" onClick={() => { setActiveTab('dashboard'); setSidebarOpen(false); setShowSupport(false); }}>üìà {t('dashboard')}</button>
              <button className="sidebar-item" onClick={() => { setShowSupport(true); setSidebarOpen(false); }}>üéß {t('support')}</button>
              <div className="sidebar-divider" />
              {/* Language selector in sidebar */}
              <div style={{ padding: '12px 16px' }}>
                <span style={{ fontSize: '12px', color: 'var(--text-secondary)', display: 'block', marginBottom: '8px' }}>{t('language')}</span>
                <div style={{ display: 'flex', gap: '8px' }}>
                  <button 
                    className="btn" 
                    style={{ 
                      padding: '6px 10px',
                      fontSize: '12px',
                      background: language === 'ru' ? '#3b82f6' : 'var(--bg-primary)', 
                      color: language === 'ru' ? 'white' : 'var(--text-primary)',
                      flex: 1 
                    }} 
                    onClick={() => handleChangeLanguage('ru')}
                  >
                    üá∑üá∫ RU
                  </button>
                  <button 
                    className="btn" 
                    style={{ 
                      padding: '6px 10px',
                      fontSize: '12px',
                      background: language === 'en' ? '#3b82f6' : 'var(--bg-primary)', 
                      color: language === 'en' ? 'white' : 'var(--text-primary)',
                      flex: 1 
                    }} 
                    onClick={() => handleChangeLanguage('en')}
                  >
                    üá¨üáß EN
                  </button>
                </div>
              </div>
              {/* Currency selector in sidebar */}
              <div style={{ padding: '12px 16px' }}>
                <span style={{ fontSize: '12px', color: 'var(--text-secondary)', display: 'block', marginBottom: '8px' }}>{t('currency')}</span>
                <div style={{ display: 'flex', gap: '8px' }}>
                  <button 
                    className="btn" 
                    style={{ 
                      padding: '6px 8px',
                      fontSize: '12px',
                      background: currency === 'EUR' ? '#3b82f6' : 'var(--bg-primary)', 
                      color: currency === 'EUR' ? 'white' : 'var(--text-primary)',
                      flex: 1 
                    }} 
                    onClick={() => handleChangeCurrency('EUR')}
                  >
                    ‚Ç¨
                  </button>
                  <button 
                    className="btn" 
                    style={{ 
                      padding: '6px 8px',
                      fontSize: '12px',
                      background: currency === 'USD' ? '#3b82f6' : 'var(--bg-primary)', 
                      color: currency === 'USD' ? 'white' : 'var(--text-primary)',
                      flex: 1 
                    }} 
                    onClick={() => handleChangeCurrency('USD')}
                  >
                    $
                  </button>
                  <button 
                    className="btn" 
                    style={{ 
                      padding: '6px 8px',
                      fontSize: '12px',
                      background: currency === 'UAH' ? '#3b82f6' : 'var(--bg-primary)', 
                      color: currency === 'UAH' ? 'white' : 'var(--text-primary)',
                      flex: 1 
                    }} 
                    onClick={() => handleChangeCurrency('UAH')}
                  >
                    ‚Ç¥
                  </button>
                </div>
              </div>
              <div className="sidebar-divider" />
              <div className="theme-toggle">
                <span>üåô {t('darkTheme')}</span>
                <div className={`toggle-switch ${theme === 'dark' ? 'active' : ''}`} onClick={toggleTheme} />
              </div>
              <div className="sidebar-divider" />
              <button className="sidebar-item" onClick={handleLogout}>üö™ {t('logout')}</button>
            </div>
          </div>

          {showProfile && (
            <div className="modal-overlay" onClick={() => setShowProfile(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">
                  <h2>{t('profile')}</h2>
                  <button className="close-modal" onClick={() => setShowProfile(false)}>‚úï</button>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
                    <div className="profile-avatar">{user?.name?.charAt(0) || '?'}</div>
                    <div>
                      <h4>{user?.name}</h4>
                      <p style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>@{user?.login}</p>
                      {user?.email && <p style={{ fontSize: '12px', color: '#6b7280' }}>üìß {user.email}</p>}
                    </div>
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <h3 style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '12px' }}>{t('emailLabel')}</h3>
                  <div className="form-group">
                    <input type="email" placeholder="your@email.com" defaultValue={user?.email || ''} onChange={(e) => setEmailInput(e.target.value)} />
                  </div>
                  <button className="btn btn-secondary" onClick={handleUpdateEmail}>{t('updateEmail')}</button>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <h3 style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '12px' }}>{t('language')}</h3>
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <button 
                      className="btn" 
                      style={{ 
                        background: language === 'ru' ? '#3b82f6' : 'var(--bg-primary)', 
                        color: language === 'ru' ? 'white' : 'var(--text-primary)',
                        flex: 1 
                      }} 
                      onClick={() => handleChangeLanguage('ru')}
                    >
                      üá∑üá∫ –†—É—Å—Å–∫–∏–π
                    </button>
                    <button 
                      className="btn" 
                      style={{ 
                        background: language === 'en' ? '#3b82f6' : 'var(--bg-primary)', 
                        color: language === 'en' ? 'white' : 'var(--text-primary)',
                        flex: 1 
                      }} 
                      onClick={() => handleChangeLanguage('en')}
                    >
                      üá¨üáß English
                    </button>
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <h3 style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '12px' }}>{t('currency')}</h3>
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <button 
                      className="btn" 
                      style={{ 
                        background: currency === 'EUR' ? '#3b82f6' : 'var(--bg-primary)', 
                        color: currency === 'EUR' ? 'white' : 'var(--text-primary)',
                        flex: 1 
                      }} 
                      onClick={() => handleChangeCurrency('EUR')}
                    >
                      ‚Ç¨ EUR
                    </button>
                    <button 
                      className="btn" 
                      style={{ 
                        background: currency === 'USD' ? '#3b82f6' : 'var(--bg-primary)', 
                        color: currency === 'USD' ? 'white' : 'var(--text-primary)',
                        flex: 1 
                      }} 
                      onClick={() => handleChangeCurrency('USD')}
                    >
                      $ USD
                    </button>
                    <button 
                      className="btn" 
                      style={{ 
                        background: currency === 'UAH' ? '#3b82f6' : 'var(--bg-primary)', 
                        color: currency === 'UAH' ? 'white' : 'var(--text-primary)',
                        flex: 1 
                      }} 
                      onClick={() => handleChangeCurrency('UAH')}
                    >
                      ‚Ç¥ UAH
                    </button>
                  </div>
                </div>
                <div style={{ marginBottom: '24px' }}>
                  <h3 style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '12px' }}>{t('adminPanel')}</h3>
                  {!isAdminVerified ? (
                    <div>
                      <div className="form-group">
                        <input 
                          type="password" 
                          placeholder={t('enterAdminKey')} 
                          value={adminKeyInput} 
                          onChange={(e) => setAdminKeyInput(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && verifyAdminKey()}
                        />
                      </div>
                      <button className="btn btn-secondary" onClick={verifyAdminKey}>{t('verify')}</button>
                    </div>
                  ) : (
                    <button className="btn btn-primary" onClick={() => { setShowAdminPanel(true); setShowProfile(false); loadAllTickets(); }}>
                      üõ°Ô∏è {t('adminPanel')}
                    </button>
                  )}
                </div>
                <div>
                  <h3 style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '12px' }}>{t('security')}</h3>
                  <button className="btn btn-primary" onClick={() => { setShowChangePassword(true); setShowProfile(false); }}>{t('changePasswordBtn')}</button>
                </div>
              </div>
            </div>
          )}

          {/* Currency Conversion Confirmation Modal */}
          {showCurrencyConfirm && (
            <div className="modal-overlay" onClick={cancelCurrencyChange}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '400px' }}>
                <div className="modal-header">
                  <h2>üí± {t('confirmCurrencyChange')}</h2>
                  <button className="close-modal" onClick={cancelCurrencyChange}>‚úï</button>
                </div>
                <div style={{ textAlign: 'center', padding: '16px 0' }}>
                  <div style={{ fontSize: '48px', marginBottom: '16px' }}>üí±</div>
                  <p style={{ fontSize: '18px', color: 'var(--text-primary)', marginBottom: '8px' }}>
                    {t('currencyChangeDesc')}
                  </p>
                  <p style={{ fontSize: '24px', fontWeight: 'bold', color: '#3b82f6', marginBottom: '16px' }}>
                    {currency} ‚Üí {pendingCurrency}
                  </p>
                  {exchangeRate && (
                    <div style={{ background: 'var(--bg-primary)', padding: '16px', borderRadius: '8px', marginBottom: '16px' }}>
                      <p style={{ fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '8px' }}>
                        {t('exchangeRate')}
                      </p>
                      <p style={{ fontSize: '20px', fontWeight: 'bold', color: 'var(--text-primary)' }}>
                        1 {currency} = {exchangeRate.rate?.toFixed(4)} {pendingCurrency}
                      </p>
                      <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '8px' }}>
                        {t('conversionInfo')}
                      </p>
                    </div>
                  )}
                  <div style={{ display: 'flex', gap: '12px' }}>
                    <button 
                      className="btn" 
                      style={{ flex: 1, background: '#6b7280', color: 'white' }}
                      onClick={cancelCurrencyChange}
                      disabled={currencyConverting}
                    >
                      {t('cancel')}
                    </button>
                    <button 
                      className="btn btn-primary" 
                      style={{ flex: 1 }}
                      onClick={confirmCurrencyChange}
                      disabled={currencyConverting}
                    >
                      {currencyConverting ? t('converting') : t('confirm')}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showAdminPanel && (
            <div className="modal-overlay" onClick={() => setShowAdminPanel(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '800px', maxHeight: '90vh' }}>
                <div className="modal-header">
                  <h2>üõ°Ô∏è {t('adminPanel')}</h2>
                  <button className="close-modal" onClick={() => setShowAdminPanel(false)}>‚úï</button>
                </div>
                
                {!selectedAdminTicket ? (
                  <div>
                    {/* Support Stats */}
                    {supportStats && (
                      <div style={{ background: 'var(--bg-primary)', padding: '16px', borderRadius: '8px', marginBottom: '20px' }}>
                        <h4 style={{ fontSize: '16px', marginBottom: '12px', color: 'var(--text-primary)' }}>
                          ‚≠ê {language === 'ru' ? '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏' : 'Support Statistics'}
                        </h4>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px', marginBottom: '12px' }}>
                          <div style={{ textAlign: 'center', padding: '12px', background: 'var(--bg-card)', borderRadius: '8px' }}>
                            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#3b82f6' }}>{supportStats.totalTickets}</div>
                            <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>{language === 'ru' ? '–í—Å–µ–≥–æ' : 'Total'}</div>
                          </div>
                          <div style={{ textAlign: 'center', padding: '12px', background: 'var(--bg-card)', borderRadius: '8px' }}>
                            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#22c55e' }}>{supportStats.openTickets}</div>
                            <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>{language === 'ru' ? '–û—Ç–∫—Ä—ã—Ç—ã' : 'Open'}</div>
                          </div>
                          <div style={{ textAlign: 'center', padding: '12px', background: 'var(--bg-card)', borderRadius: '8px' }}>
                            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#6b7280' }}>{supportStats.closedTickets}</div>
                            <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>{language === 'ru' ? '–ó–∞–∫—Ä—ã—Ç—ã' : 'Closed'}</div>
                          </div>
                        </div>
                        {supportStats.totalRatings > 0 && (
                          <div style={{ padding: '12px', background: 'var(--bg-card)', borderRadius: '8px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '8px' }}>
                              <span style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>{language === 'ru' ? '–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:' : 'Average rating:'}</span>
                              <span style={{ fontSize: '20px', fontWeight: 'bold', color: '#f59e0b' }}>
                                {'‚≠ê'.repeat(Math.round(supportStats.averageRating))} {supportStats.averageRating}/5
                              </span>
                            </div>
                            <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                              {language === 'ru' ? '–û—Ü–µ–Ω–æ–∫:' : 'Ratings:'} {supportStats.totalRatings}
                            </div>
                            {/* Rating distribution */}
                            <div style={{ marginTop: '8px' }}>
                              {[5, 4, 3, 2, 1].map(star => (
                                <div key={star} style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
                                  <span style={{ fontSize: '12px', width: '30px' }}>{star}‚≠ê</span>
                                  <div style={{ flex: 1, height: '8px', background: 'var(--bg-primary)', borderRadius: '4px', overflow: 'hidden' }}>
                                    <div style={{ 
                                      width: `${supportStats.totalRatings > 0 ? (supportStats.ratingDistribution[star] / supportStats.totalRatings * 100) : 0}%`, 
                                      height: '100%', 
                                      background: '#f59e0b',
                                      borderRadius: '4px'
                                    }} />
                                  </div>
                                  <span style={{ fontSize: '11px', color: 'var(--text-secondary)', width: '30px', textAlign: 'right' }}>
                                    {supportStats.ratingDistribution[star]}
                                  </span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                    
                    <h3 style={{ fontSize: '18px', marginBottom: '16px', color: 'var(--text-primary)' }}>{t('allTickets')}</h3>
                    {allTickets.length === 0 ? (
                      <p style={{ color: 'var(--text-secondary)', textAlign: 'center', padding: '24px' }}>–ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</p>
                    ) : (
                      <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                        {allTickets.map(ticket => (
                          <div 
                            key={ticket.id} 
                            onClick={() => setSelectedAdminTicket(ticket)}
                            style={{ 
                              padding: '12px 16px', 
                              border: '1px solid var(--border-color)', 
                              borderRadius: '8px', 
                              marginBottom: '8px',
                              cursor: 'pointer',
                              background: 'var(--bg-card)'
                            }}
                          >
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                              <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{ticket.subject}</span>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                {ticket.rating && (
                                  <span style={{ fontSize: '14px' }}>{'‚≠ê'.repeat(ticket.rating)}</span>
                                )}
                                <span className={`badge ${ticket.status === 'open' ? 'badge-success' : 'badge-info'}`}>
                                  {ticket.status === 'open' ? t('open') : t('closed')}
                                </span>
                              </div>
                            </div>
                            <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '4px' }}>
                              {t('from')}: {ticket.userName} ({ticket.userEmail}) ¬∑ {new Date(ticket.createdAt).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'en-US')} ¬∑ {ticket.messages.length} {t('messages')}
                            </p>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                ) : (
                  <div>
                    <button className="btn" style={{ background: 'var(--bg-primary)', color: 'var(--text-primary)', marginBottom: '16px' }} onClick={() => setSelectedAdminTicket(null)}>‚Üê {t('back')}</button>
                    <h3 style={{ fontSize: '18px', marginBottom: '8px', color: 'var(--text-primary)' }}>{selectedAdminTicket.subject}</h3>
                    <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginBottom: '16px' }}>
                      {t('from')}: {selectedAdminTicket.userName} ({selectedAdminTicket.userEmail})
                    </p>
                    <div style={{ maxHeight: '350px', overflowY: 'auto', marginBottom: '16px', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                      {selectedAdminTicket.messages.map((msg, idx) => (
                        <div key={msg.id} style={{ marginBottom: '12px', textAlign: msg.from === 'user' ? 'left' : 'right' }}>
                          <div 
                            style={{ 
                              display: 'inline-block',
                              padding: '10px 14px', 
                              borderRadius: '12px',
                              background: msg.from === 'user' ? 'var(--bg-card)' : '#3b82f6',
                              color: msg.from === 'user' ? 'var(--text-primary)' : 'white',
                              border: msg.from === 'user' ? '1px solid var(--border-color)' : 'none',
                              maxWidth: '80%',
                              textAlign: 'left'
                            }}
                          >
                            <p style={{ margin: 0, fontSize: '12px', opacity: 0.7, marginBottom: '4px' }}>
                              {msg.from === 'user' ? selectedAdminTicket.userName : 'Support'}
                            </p>
                            <p style={{ margin: 0 }}>{msg.text}</p>
                            <small style={{ fontSize: '11px', opacity: 0.7, display: 'block', marginTop: '4px' }}>
                              {new Date(msg.createdAt).toLocaleString(language === 'ru' ? 'ru-RU' : 'en-US')}
                            </small>
                          </div>
                        </div>
                      ))}
                    </div>
                    <div style={{ display: 'flex', gap: '8px' }}>
                      <input 
                        type="text" 
                        placeholder={t('reply')} 
                        value={adminReplyMessage} 
                        onChange={(e) => setAdminReplyMessage(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && sendAdminReply()}
                        style={{ flex: 1, padding: '10px', borderRadius: '8px', border: '1px solid var(--input-border)', background: 'var(--input-bg)', color: 'var(--text-primary)' }}
                      />
                      <button className="btn btn-primary" onClick={sendAdminReply} disabled={!adminReplyMessage.trim()}>{t('sendReply')}</button>
                    </div>
                    {selectedAdminTicket.status === 'open' && (
                      <button 
                        className="btn" 
                        style={{ marginTop: '12px', background: '#ef4444', color: 'white', width: '100%' }}
                        onClick={() => closeAdminTicket(selectedAdminTicket.id)}
                      >
                        {t('closeTicket')}
                      </button>
                    )}
                  </div>
                )}
              </div>
            </div>
          )}

          {showChangePassword && (
            <div className="modal-overlay" onClick={() => setShowChangePassword(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">
                  <h2>{t('changePassword')}</h2>
                  <button className="close-modal" onClick={() => setShowChangePassword(false)}>‚úï</button>
                </div>
                {passwordError && <div className="auth-error">{passwordError}</div>}
                {passwordSuccess && <div className="auth-success">{passwordSuccess}</div>}
                <div className="form-group">
                  <label>{t('currentPassword')}</label>
                  <div className="password-input-wrapper">
                    <input type={showCurrentPassword ? 'text' : 'password'} value={currentPassword} onChange={(e) => setCurrentPassword(e.target.value)} />
                    <button type="button" className="password-toggle" onClick={() => setShowCurrentPassword(!showCurrentPassword)}>
                      {showCurrentPassword ? 'üôà' : 'üëÅÔ∏è'}
                    </button>
                  </div>
                </div>
                <div className="form-group">
                  <label>{t('newPasswordLabel')}</label>
                  <div className="password-input-wrapper">
                    <input type={showNewPassword ? 'text' : 'password'} value={newPassword} onChange={(e) => setNewPassword(e.target.value)} />
                    <button type="button" className="password-toggle" onClick={() => setShowNewPassword(!showNewPassword)}>
                      {showNewPassword ? 'üôà' : 'üëÅÔ∏è'}
                    </button>
                  </div>
                </div>
                <div className="form-group">
                  <label>{t('confirmPasswordLabel')}</label>
                  <div className="password-input-wrapper">
                    <input type={showConfirmPassword ? 'text' : 'password'} value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} />
                    <button type="button" className="password-toggle" onClick={() => setShowConfirmPassword(!showConfirmPassword)}>
                      {showConfirmPassword ? 'üôà' : 'üëÅÔ∏è'}
                    </button>
                  </div>
                </div>
                <button className="auth-btn" onClick={handleChangePassword}>{t('changePasswordBtn')}</button>
              </div>
            </div>
          )}

          {showSupport && (
            <div className="modal-overlay" onClick={() => setShowSupport(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '700px', maxHeight: '85vh' }}>
                <div className="modal-header">
                  <h2>üéß {t('support')}</h2>
                  <button className="close-modal" onClick={() => setShowSupport(false)}>‚úï</button>
                </div>
                
                {!showNewTicket && !selectedTicket && (
                  <div>
                    {/* FAQ Section */}
                    <div style={{ marginBottom: '24px' }}>
                      <h3 style={{ fontSize: '18px', marginBottom: '12px', color: 'var(--text-primary)' }}>‚ùì {t('faq')}</h3>
                      <div style={{ maxHeight: '200px', overflowY: 'auto' }}>
                        {faq.map((item, idx) => (
                          <div key={item.id} style={{ border: '1px solid var(--border-color)', borderRadius: '8px', marginBottom: '8px', overflow: 'hidden' }}>
                            <button 
                              onClick={() => setExpandedFAQ(expandedFAQ === idx ? null : idx)}
                              style={{ 
                                width: '100%', 
                                padding: '12px 16px', 
                                textAlign: 'left', 
                                background: expandedFAQ === idx ? 'var(--bg-primary)' : 'var(--bg-card)',
                                border: 'none',
                                cursor: 'pointer',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                color: 'var(--text-primary)'
                              }}
                            >
                              <span>{item.question}</span>
                              <span>{expandedFAQ === idx ? '‚ñ≤' : '‚ñº'}</span>
                            </button>
                            {expandedFAQ === idx && (
                              <div style={{ padding: '12px 16px', background: 'var(--bg-primary)', color: 'var(--text-secondary)', fontSize: '14px', lineHeight: '1.5' }}>
                                {item.answer}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Tickets Section */}
                    <div>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                        <h3 style={{ fontSize: '18px', color: 'var(--text-primary)' }}>üé´ {t('myTickets')}</h3>
                        <button className="btn btn-primary" onClick={() => setShowNewTicket(true)}>+ {t('newTicket')}</button>
                      </div>
                      {tickets.length === 0 ? (
                        <p style={{ color: 'var(--text-secondary)', textAlign: 'center', padding: '24px' }}>{t('noTickets')}</p>
                      ) : (
                        <div style={{ maxHeight: '250px', overflowY: 'auto' }}>
                          {tickets.map(ticket => (
                            <div 
                              key={ticket.id} 
                              onClick={() => setSelectedTicket(ticket)}
                              style={{ 
                                padding: '12px 16px', 
                                border: '1px solid var(--border-color)', 
                                borderRadius: '8px', 
                                marginBottom: '8px',
                                cursor: 'pointer',
                                background: 'var(--bg-card)'
                              }}
                            >
                              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <span style={{ fontWeight: '600', color: 'var(--text-primary)' }}>{ticket.subject}</span>
                                <span className={`badge ${ticket.status === 'open' ? 'badge-success' : 'badge-info'}`}>
                                  {ticket.status === 'open' ? '–û—Ç–∫—Ä—ã—Ç' : '–ó–∞–∫—Ä—ã—Ç'}
                                </span>
                              </div>
                              <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '4px' }}>
                                {new Date(ticket.createdAt).toLocaleDateString('ru-RU')} ¬∑ {ticket.messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π
                              </p>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {showNewTicket && (
                  <div>
                    <button className="btn" style={{ background: 'var(--bg-primary)', color: 'var(--text-primary)', marginBottom: '16px' }} onClick={() => setShowNewTicket(false)}>‚Üê {t('back')}</button>
                    <h3 style={{ fontSize: '18px', marginBottom: '16px', color: 'var(--text-primary)' }}>{t('newTicket')}</h3>
                    <div className="form-group">
                      <label>{t('ticketSubject')}</label>
                      <input type="text" placeholder={t('subjectPlaceholder')} value={ticketSubject} onChange={(e) => setTicketSubject(e.target.value)} />
                    </div>
                    <div className="form-group">
                      <label>{t('message')}</label>
                      <textarea placeholder={t('messagePlaceholder')} value={ticketMessage} onChange={(e) => setTicketMessage(e.target.value)} rows={5} />
                    </div>
                    <button className="btn btn-primary" onClick={handleCreateTicket} disabled={!ticketSubject.trim() || !ticketMessage.trim()}>
                      {t('sendTicket')}
                    </button>
                  </div>
                )}

                {selectedTicket && (
                  <div>
                    <button className="btn" style={{ background: 'var(--bg-primary)', color: 'var(--text-primary)', marginBottom: '16px' }} onClick={() => setSelectedTicket(null)}>‚Üê {t('back')}</button>
                    <h3 style={{ fontSize: '18px', marginBottom: '8px', color: 'var(--text-primary)' }}>{selectedTicket.subject}</h3>
                    <div style={{ maxHeight: '300px', overflowY: 'auto', marginBottom: '16px', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                      {selectedTicket.messages.map((msg, idx) => (
                        <div key={msg.id} style={{ marginBottom: '12px', textAlign: msg.from === 'user' ? 'right' : 'left' }}>
                          <div 
                            style={{ 
                              display: 'inline-block',
                              padding: '10px 14px', 
                              borderRadius: '12px',
                              background: msg.from === 'user' ? '#3b82f6' : 'var(--bg-card)',
                              color: msg.from === 'user' ? 'white' : 'var(--text-primary)',
                              border: msg.from === 'user' ? 'none' : '1px solid var(--border-color)',
                              maxWidth: '80%',
                              textAlign: 'left'
                            }}
                          >
                            <p style={{ margin: 0 }}>{msg.text}</p>
                            <small style={{ fontSize: '11px', opacity: 0.7, display: 'block', marginTop: '4px' }}>
                              {new Date(msg.createdAt).toLocaleString('ru-RU')}
                            </small>
                          </div>
                        </div>
                      ))}
                    </div>
                    <div style={{ display: 'flex', gap: '8px' }}>
                      <input 
                        type="text" 
                        placeholder={t('reply')} 
                        value={replyMessage} 
                        onChange={(e) => setReplyMessage(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleSendReply()}
                        style={{ flex: 1, padding: '10px', borderRadius: '8px', border: '1px solid var(--input-border)', background: 'var(--input-bg)', color: 'var(--text-primary)' }}
                      />
                      <button className="btn btn-primary" onClick={handleSendReply} disabled={!replyMessage.trim()}>{t('send')}</button>
                    </div>
                    {selectedTicket.status === 'open' && (
                      <button 
                        className="btn" 
                        style={{ marginTop: '12px', background: '#22c55e', color: 'white', width: '100%' }}
                        onClick={() => openCloseTicketModal(selectedTicket)}
                      >
                        ‚úì {t('problemSolved')}
                      </button>
                    )}
                    {selectedTicket.status === 'closed' && selectedTicket.rating && (
                      <div style={{ marginTop: '12px', textAlign: 'center', padding: '12px', background: 'var(--bg-primary)', borderRadius: '8px' }}>
                        <p style={{ fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '8px' }}>{t('yourRating')}</p>
                        <div style={{ fontSize: '24px' }}>
                          {'‚≠ê'.repeat(selectedTicket.rating)}
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Rating Modal */}
          {showRatingModal && ticketToClose && (
            <div className="modal-overlay" onClick={() => setShowRatingModal(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '400px' }}>
                <div className="modal-header">
                  <h2>‚≠ê {t('rateSupport')}</h2>
                  <button className="close-modal" onClick={() => setShowRatingModal(false)}>‚úï</button>
                </div>
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <p style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '20px' }}>
                    {t('rateSupportDesc')}
                  </p>
                  <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '24px' }}>
                    {[1, 2, 3, 4, 5].map((star) => (
                      <button
                        key={star}
                        onClick={() => setSupportRating(star)}
                        style={{
                          fontSize: '32px',
                          background: 'none',
                          border: 'none',
                          cursor: 'pointer',
                          filter: supportRating >= star ? 'none' : 'grayscale(100%)',
                          opacity: supportRating >= star ? 1 : 0.3,
                          transition: 'all 0.2s'
                        }}
                      >
                        ‚≠ê
                      </button>
                    ))}
                  </div>
                  <div style={{ display: 'flex', gap: '12px' }}>
                    <button 
                      className="btn" 
                      style={{ flex: 1, background: '#6b7280', color: 'white' }}
                      onClick={() => setShowRatingModal(false)}
                    >
                      {t('skipRating')}
                    </button>
                    <button 
                      className="btn btn-primary" 
                      style={{ flex: 1 }}
                      onClick={closeUserTicket}
                    >
                      {supportRating > 0 ? t('submitRating') : t('closeWithoutRating')}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* AI Chat Widget */}
          {token && (
            <div style={{ position: 'fixed', bottom: '20px', right: '20px', zIndex: 500 }}>
              {!aiChatOpen && (
                <button 
                  onClick={() => setAiChatOpen(true)}
                  style={{ 
                    width: '60px', 
                    height: '60px', 
                    borderRadius: '50%', 
                    background: 'linear-gradient(135deg, #667eea, #764ba2)', 
                    color: 'white',
                    border: 'none',
                    fontSize: '24px',
                    cursor: 'pointer',
                    boxShadow: '0 4px 12px rgba(0,0,0,0.3)'
                  }}
                >
                  ü§ñ
                </button>
              )}
              {aiChatOpen && (
                <div style={{ 
                  width: '350px', 
                  height: '450px', 
                  background: 'var(--bg-card)', 
                  borderRadius: '16px', 
                  boxShadow: '0 10px 40px rgba(0,0,0,0.3)',
                  display: 'flex',
                  flexDirection: 'column',
                  overflow: 'hidden',
                  border: '1px solid var(--border-color)'
                }}>
                  <div style={{ 
                    padding: '16px', 
                    background: 'linear-gradient(135deg, #667eea, #764ba2)', 
                    color: 'white',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                  }}>
                    <span style={{ fontWeight: '600' }}>ü§ñ {t('aiAssistant')}</span>
                    <button onClick={() => setAiChatOpen(false)} style={{ background: 'none', border: 'none', color: 'white', fontSize: '20px', cursor: 'pointer' }}>‚úï</button>
                  </div>
                  <div style={{ flex: 1, overflowY: 'auto', padding: '16px' }}>
                    {aiMessages.map((msg, idx) => (
                      <div key={idx} style={{ marginBottom: '12px', textAlign: msg.from === 'user' ? 'right' : 'left' }}>
                        <div 
                          style={{ 
                            display: 'inline-block',
                            padding: '10px 14px', 
                            borderRadius: '12px',
                            background: msg.from === 'user' ? '#3b82f6' : 'var(--bg-primary)',
                            color: msg.from === 'user' ? 'white' : 'var(--text-primary)',
                            border: msg.from === 'user' ? 'none' : '1px solid var(--border-color)',
                            maxWidth: '85%',
                            textAlign: 'left',
                            fontSize: '14px',
                            lineHeight: '1.4'
                          }}
                        >
                          {msg.text}
                        </div>
                      </div>
                    ))}
                    {aiLoading && (
                      <div style={{ textAlign: 'left' }}>
                        <div style={{ display: 'inline-block', padding: '10px 14px', background: 'var(--bg-primary)', borderRadius: '12px' }}>
                          <span style={{ fontSize: '20px', animation: 'pulse 1s infinite' }}>‚Ä¢‚Ä¢‚Ä¢</span>
                        </div>
                      </div>
                    )}
                  </div>
                  <div style={{ padding: '12px', borderTop: '1px solid var(--border-color)', display: 'flex', gap: '8px' }}>
                    <input 
                      type="text" 
                      placeholder={t('askQuestion')} 
                      value={aiInput} 
                      onChange={(e) => setAiInput(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleAISend()}
                      style={{ flex: 1, padding: '10px', borderRadius: '8px', border: '1px solid var(--input-border)', background: 'var(--input-bg)', color: 'var(--text-primary)' }}
                    />
                    <button 
                      onClick={handleAISend} 
                      disabled={!aiInput.trim() || aiLoading}
                      style={{ 
                        padding: '10px 16px', 
                        background: '#3b82f6', 
                        color: 'white', 
                        border: 'none', 
                        borderRadius: '8px',
                        cursor: 'pointer'
                      }}
                    >
                      ‚û§
                    </button>
                  </div>
                </div>
              )}
            </div>
          )}

          <main className="main-content">
            <div className="stats-grid">
              <div className="stat-card purchases">
                <div>
                  <div className="stat-label">{t('totalPurchases')}</div>
                  <div className="stat-value purchases">{formatCurrency(totalPurchases)}</div>
                </div>
                <div className="stat-icon purchases">üì¶</div>
              </div>
              <div className="stat-card sales">
                <div>
                  <div className="stat-label">{t('totalSales')}</div>
                  <div className="stat-value sales">{formatCurrency(totalSales)}</div>
                </div>
                <div className="stat-icon sales">üõí</div>
              </div>
              <div className="stat-card" style={{ borderColor: '#ddd6fe' }}>
                <div>
                  <div className="stat-label">{t('revenue')}</div>
                  <div className="stat-value" style={{ color: '#7c3aed' }}>{formatCurrency(totalSales)}</div>
                </div>
                <div className="stat-icon" style={{ background: '#ede9fe' }}>üí∞</div>
              </div>
              <div className={`stat-card profit ${totalProfit < 0 ? 'negative' : ''}`}>
                <div>
                  <div className="stat-label">{t('profit')}</div>
                  <div className={`stat-value profit ${totalProfit < 0 ? 'negative' : ''}`}>{formatCurrency(totalProfit)}</div>
                </div>
                <div className={`stat-icon profit ${totalProfit < 0 ? 'negative' : ''}`}>üìà</div>
              </div>
            </div>

            <div className="branch-selector">
              <div className="branch-controls">
                <select className="branch-select" value={currentBranchId} onChange={(e) => setCurrentBranchId(e.target.value)}>
                  {branches.map(b => <option key={b.id} value={b.id}>{b.name}</option>)}
                </select>
                <button className="btn-small" style={{ background: '#10b981', color: 'white' }} onClick={() => setShowNewBranchForm(!showNewBranchForm)}>+ {t('newBranch')}</button>
                {branches.length > 1 && (
                  <button className="btn-small" style={{ background: '#dc2626', color: 'white' }} onClick={() => deleteBranch(currentBranchId)}>{t('deleteBranch')}</button>
                )}
              </div>
              {showNewBranchForm && (
                <div style={{ marginTop: '12px', display: 'flex', gap: '8px' }}>
                  <input type="text" placeholder={t('branchName')} value={newBranchName} onChange={(e) => setNewBranchName(e.target.value)} style={{ flex: 1, padding: '8px', borderRadius: '6px', border: '1px solid var(--input-border)', background: 'var(--input-bg)', color: 'var(--text-primary)' }} />
                  <button className="btn-small" style={{ background: '#10b981', color: 'white' }} onClick={createBranch}>{t('create')}</button>
                  <button className="btn-small" style={{ background: '#6b7280', color: 'white' }} onClick={() => setShowNewBranchForm(false)}>{t('cancel')}</button>
                </div>
              )}
            </div>

            {/* Charts Section - always visible on main page */}
            {(purchases.length > 0 || sales.length > 0) && (
              <div style={{ marginBottom: '24px' }}>
                <ChartsSection 
                  sales={sales} 
                  purchases={purchases} 
                  branches={branches}
                  currency={currency}
                  language={language}
                  formatCurrency={formatCurrency}
                />
              </div>
            )}

            <div className="tabs">
              <button className={`tab ${activeTab === 'add' ? 'active' : ''}`} onClick={() => setActiveTab('add')}>‚ûï {t('add')}</button>
              <button className={`tab ${activeTab === 'history' ? 'active' : ''}`} onClick={() => setActiveTab('history')}>üìã {t('history')}</button>
              <button className={`tab ${activeTab === 'summary' ? 'active' : ''}`} onClick={() => setActiveTab('summary')}>üìä {t('summary')}</button>
              <button className={`tab ${activeTab === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveTab('dashboard')}>üìÖ {t('dashboard')}</button>
            </div>

            <div className="tab-content">
              {activeTab === 'add' && (
                <div className="form-grid">
                  <div className="form-card purchase">
                    <h3>üì¶ {t('newPurchase')}</h3>
                    <div className="form-group">
                      <label>{t('productName')}</label>
                      <input type="text" placeholder={t('productPlaceholder')} value={purchaseName} onChange={(e) => setPurchaseName(e.target.value)} />
                    </div>
                    <div className="form-row">
                      <div className="form-group">
                        <label>{t('quantity')}</label>
                        <input type="number" min="1" placeholder="1" value={purchaseQty} onChange={(e) => setPurchaseQty(e.target.value)} />
                      </div>
                      <div className="form-group">
                        <label>{t('price')} ({currencies[currency].symbol})</label>
                        <input type="number" min="0" step="0.01" placeholder="0.00" value={purchasePrice} onChange={(e) => setPurchasePrice(e.target.value)} />
                      </div>
                    </div>
                    <div className="form-group">
                      <label>{t('date')}</label>
                      <input type="date" value={purchaseDate} onChange={(e) => setPurchaseDate(e.target.value)} />
                    </div>
                    <div className="form-group">
                      <label>{t('photo')}</label>
                      <input type="file" accept="image/*" onChange={(e) => handlePhotoUpload(e, setPurchasePhoto)} />
                      {purchasePhoto && <img src={purchasePhoto} alt="Preview" onClick={() => { setPreviewPhoto(purchasePhoto); setShowPreview(true); }} className="product-img" style={{ width: '50px', height: '50px', marginTop: '8px' }} />}
                    </div>
                    <div className="form-group">
                      <label>{t('notes')}</label>
                      <textarea placeholder={t('notesPlaceholder')} value={purchaseNotes} onChange={(e) => setPurchaseNotes(e.target.value)} rows={2} />
                    </div>
                    {purchaseQty && purchasePrice && (
                      <div className="summary-box">
                        <p style={{ margin: 0, fontSize: '14px' }}>{t('total')}: <strong>{formatCurrency(Number(purchaseQty) * Number(purchasePrice))}</strong></p>
                      </div>
                    )}
                    <button className="btn btn-primary" style={{ marginTop: '12px', width: '100%' }} onClick={addPurchase} disabled={!purchaseName || !purchaseQty || !purchasePrice}>{t('addPurchase')}</button>
                  </div>

                  <div className="form-card sale">
                    <h3>üõí –ù–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞</h3>
                    <div className="form-group">
                      <label>–¢–æ–≤–∞—Ä</label>
                      <select value={saleProduct} onChange={(e) => {
                        const selected = availableProducts.find(p => p.name === e.target.value);
                        setSaleProduct(e.target.value);
                        if (selected) {
                          const relevantPurchases = purchases.filter(p => 
                            p.branchId === currentBranchId && 
                            p.productName === selected.name && 
                            p.remainingQty > 0
                          );
                          const firstPurchase = relevantPurchases[0];
                          setSalePurchasePrice(firstPurchase?.price?.toString() || '0');
                        }
                      }}>
                        <option value="">{t('selectProduct')}</option>
                        {availableProducts.map(p => (
                          <option key={p.name} value={p.name}>{p.name} ({t('remaining')}: {p.remaining})</option>
                        ))}
                      </select>
                    </div>
                    {saleProduct && availableProducts.find(p => p.name === saleProduct)?.photo && (
                      <div className="form-group">
                        <img src={availableProducts.find(p => p.name === saleProduct)?.photo} alt="Product" onClick={() => { setPreviewPhoto(availableProducts.find(p => p.name === saleProduct)?.photo); setShowPreview(true); }} className="product-img" style={{ width: '50px', height: '50px' }} />
                      </div>
                    )}
                    <div className="form-row">
                      <div className="form-group">
                        <label>{t('quantity')}</label>
                        <input type="number" min="1" placeholder="1" value={saleQty} onChange={(e) => setSaleQty(e.target.value)} />
                      </div>
                      <div className="form-group">
                        <label>{t('salePrice')} ({currencies[currency].symbol})</label>
                        <input type="number" min="0" step="0.01" placeholder="0.00" value={salePrice} onChange={(e) => setSalePrice(e.target.value)} />
                      </div>
                    </div>
                    <div className="form-group">
                      <label>{t('date')}</label>
                      <input type="date" value={saleDate} onChange={(e) => setSaleDate(e.target.value)} />
                    </div>
                    <div className="form-group">
                      <label>{t('notes')}</label>
                      <textarea placeholder={t('saleNotesPlaceholder')} value={saleNotes} onChange={(e) => setSaleNotes(e.target.value)} rows={2} />
                    </div>
                    {saleQty && salePrice && salePurchasePrice && (
                      <div className={`summary-box ${Number(saleQty) * (Number(salePrice) - Number(salePurchasePrice)) < 0 ? 'negative' : ''}`}>
                        <p style={{ margin: 0, fontSize: '14px' }}>
                          {t('profit')}: <strong style={{ color: Number(saleQty) * (Number(salePrice) - Number(salePurchasePrice)) >= 0 ? '#059669' : '#dc2626' }}>
                            {Number(saleQty) * (Number(salePrice) - Number(salePurchasePrice)) >= 0 ? '+' : ''}{formatCurrency(Number(saleQty) * (Number(salePrice) - Number(salePurchasePrice)))}
                          </strong>
                        </p>
                      </div>
                    )}
                    <button className="btn btn-secondary" style={{ marginTop: '12px', width: '100%' }} onClick={addSale} disabled={!saleProduct || !saleQty || !salePrice}>{t('addSale')}</button>
                  </div>
                </div>
              )}

              {activeTab === 'history' && (
                <div>
                  <h3 style={{ marginBottom: '16px', color: 'var(--text-primary)' }}>üì¶ {t('purchaseHistory')}</h3>
                  <div className="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>{t('photoCol')}</th>
                          <th>{t('productCol')}</th>
                          <th>{t('qtyCol')}</th>
                          <th>{t('remainingCol')}</th>
                          <th>{t('priceCol')}</th>
                          <th>{t('amountCol')}</th>
                          <th>{t('dateCol')}</th>
                          <th>{t('notesCol')}</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                        {purchases.filter(p => p.branchId === currentBranchId).map(p => (
                          <tr key={p.id}>
                            <td>{p.photo ? <img src={p.photo} alt={p.productName} onClick={() => { setPreviewPhoto(p.photo); setShowPreview(true); }} className="product-img" /> : <div className="product-placeholder">üì¶</div>}</td>
                            <td>{p.productName}</td>
                            <td>{p.quantity}</td>
                            <td><span className={`badge ${p.remainingQty > 0 ? 'badge-info' : 'badge-warning'}`}>{p.remainingQty}</span></td>
                            <td>{formatCurrency(p.price)}</td>
                            <td>{formatCurrency(p.total)}</td>
                            <td>{new Date(p.date).toLocaleDateString('ru-RU')}</td>
                            <td>
                              {editingPurchaseId === p.id ? (
                                <div className="notes-input">
                                  <input type="text" value={editNotes} onChange={(e) => setEditNotes(e.target.value)} style={{ width: '100%', marginBottom: '4px' }} />
                                  <button className="edit-btn" onClick={() => savePurchaseNotes(p.id)}>{t('save')}</button>
                                </div>
                              ) : (
                                <div>
                                  {p.notes && <div className="notes-box">{p.notes}</div>}
                                  <button className="edit-btn" onClick={() => { setEditingPurchaseId(p.id); setEditNotes(p.notes || ''); }}>{p.notes ? t('edit') : t('addNotes')}</button>
                                </div>
                              )}
                            </td>
                            <td><button className="delete-btn" onClick={() => deletePurchase(p.id)}>üóëÔ∏è</button></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  <h3 style={{ margin: '32px 0 16px', color: 'var(--text-primary)' }}>üõí {t('saleHistory')}</h3>
                  <div className="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>{t('photoCol')}</th>
                          <th>{t('productCol')}</th>
                          <th>{t('qtyCol')}</th>
                          <th>{t('purchasePriceCol')}</th>
                          <th>{t('salePriceCol')}</th>
                          <th>{t('profitCol')}</th>
                          <th>{t('dateCol')}</th>
                          <th>{t('notesCol')}</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                        {sales.filter(s => s.branchId === currentBranchId).map(s => (
                          <tr key={s.id}>
                            <td>{s.photo ? <img src={s.photo} alt={s.productName} onClick={() => { setPreviewPhoto(s.photo); setShowPreview(true); }} className="product-img" /> : <div className="product-placeholder">üõí</div>}</td>
                            <td>{s.productName}</td>
                            <td>{s.quantity}</td>
                            <td>{formatCurrency(s.purchasePrice)}</td>
                            <td>{formatCurrency(s.salePrice)}</td>
                            <td><span className={`badge ${s.profit >= 0 ? 'badge-success' : 'badge-danger'}`}>{s.profit >= 0 ? '+' : ''}{formatCurrency(s.profit)}</span></td>
                            <td>{new Date(s.date).toLocaleDateString(language === 'ru' ? 'ru-RU' : 'en-US')}</td>
                            <td>
                              {editingSaleId === s.id ? (
                                <div className="notes-input">
                                  <input type="text" value={editNotes} onChange={(e) => setEditNotes(e.target.value)} style={{ width: '100%', marginBottom: '4px' }} />
                                  <button className="edit-btn" onClick={() => saveSaleNotes(s.id)}>{t('save')}</button>
                                </div>
                              ) : (
                                <div>
                                  {s.notes && <div className="notes-box">{s.notes}</div>}
                                  <button className="edit-btn" onClick={() => { setEditingSaleId(s.id); setEditNotes(s.notes || ''); }}>{s.notes ? t('edit') : t('addNotes')}</button>
                                </div>
                              )}
                            </td>
                            <td><button className="delete-btn" onClick={() => deleteSale(s.id)}>üóëÔ∏è</button></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              )}

              {activeTab === 'summary' && (
                <div>
                  <h3 style={{ marginBottom: '16px', color: 'var(--text-primary)' }}>üìä {t('monthlySummaryTitle')}</h3>
                  
                  <div className="stats-grid" style={{ marginBottom: '24px' }}>
                    <div className="stat-card purchases">
                      <div>
                        <div className="stat-label">{t('totalPurchases')}</div>
                        <div className="stat-value purchases">{formatCurrency(monthlyPurchases.reduce((sum, p) => sum + p.total, 0))}</div>
                      </div>
                    </div>
                    <div className="stat-card sales">
                      <div>
                        <div className="stat-label">{t('totalSales')}</div>
                        <div className="stat-value sales">{formatCurrency(monthlySales.reduce((sum, s) => sum + s.totalRevenue, 0))}</div>
                      </div>
                    </div>
                    <div className={`stat-card profit ${monthlySales.reduce((sum, s) => sum + s.profit, 0) < 0 ? 'negative' : ''}`}>
                      <div>
                        <div className="stat-label">{t('profit')}</div>
                        <div className={`stat-value profit ${monthlySales.reduce((sum, s) => sum + s.profit, 0) < 0 ? 'negative' : ''}`}>
                          {formatCurrency(monthlySales.reduce((sum, s) => sum + s.profit, 0))}
                        </div>
                      </div>
                    </div>
                  </div>

                  <h4 style={{ marginBottom: '12px', color: 'var(--text-primary)' }}>{t('byProduct')}</h4>
                  <div className="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>{t('productCol')}</th>
                          <th>{t('purchased')}</th>
                          <th>{t('sold')}</th>
                          <th>{t('purchasePriceCol')} ({currencies[currency].symbol})</th>
                          <th>{t('salePriceCol')} ({currencies[currency].symbol})</th>
                          <th>{t('profitCol')}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {Object.entries(productSummary).map(([name, data]) => (
                          <tr key={name}>
                            <td><strong>{name}</strong></td>
                            <td>{data.purchased} {t('pieces')}</td>
                            <td>{data.sold} {t('pieces')}</td>
                            <td>{formatCurrency(data.purchaseAmount)}</td>
                            <td>{formatCurrency(data.saleAmount)}</td>
                            <td><span className={`badge ${data.profit >= 0 ? 'badge-success' : 'badge-danger'}`}>{data.profit >= 0 ? '+' : ''}{formatCurrency(data.profit)}</span></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  <h4 style={{ margin: '24px 0 12px', color: 'var(--text-primary)' }}>üì¶ {t('inStock')}:</h4>
                  <div className="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>{t('photoCol')}</th>
                          <th>{t('productCol')}</th>
                          <th>{t('stock')}</th>
                          <th>{t('purchasePriceCol')}</th>
                          <th>{t('action')}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {availableProducts.map(p => (
                          <tr key={p.name}>
                            <td>{p.photo ? <img src={p.photo} alt={p.name} onClick={() => { setPreviewPhoto(p.photo); setShowPreview(true); }} className="product-img" style={{ width: '50px', height: '50px' }} /> : <div className="product-placeholder" style={{ width: '50px', height: '50px', fontSize: '24px' }}>üì¶</div>}</td>
                            <td><strong>{p.name}</strong></td>
                            <td><span className="badge badge-info">{p.remaining} {t('pieces')}</span></td>
                            <td>
                              {(() => {
                                const relevantPurchases = purchases.filter(pr => 
                                  pr.branchId === currentBranchId && 
                                  pr.productName === p.name && 
                                  pr.remainingQty > 0
                                );
                                const firstPurchase = relevantPurchases[0];
                                return firstPurchase ? formatCurrency(firstPurchase.price) : '-';
                              })()}
                            </td>
                            <td><button className="sell-btn" onClick={() => openQuickSale(p.name)}>{t('sell')}</button></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  {availableProducts.length === 0 && (
                    <p style={{ textAlign: 'center', color: 'var(--text-secondary)', padding: '24px' }}>{t('noStock')}</p>
                  )}
                </div>
              )}

              {activeTab === 'dashboard' && (
                <Dashboard 
                  sales={sales} 
                  purchases={purchases} 
                  branches={branches}
                  currency={currency}
                  language={language}
                  formatCurrency={formatCurrency}
                />
              )}
            </div>
          </main>

          {showQuickSale && (
            <div className="modal-overlay" onClick={() => setShowQuickSale(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '400px' }}>
                <div className="modal-header">
                  <h2>üõí –ü—Ä–æ–¥–∞—Ç—å {quickSaleProduct}</h2>
                  <button className="close-modal" onClick={() => setShowQuickSale(false)}>‚úï</button>
                </div>
                <div>
                  {quickSalePhoto && <img src={quickSalePhoto} alt="Product" style={{ width: '100%', maxHeight: '200px', objectFit: 'contain', marginBottom: '16px', borderRadius: '8px' }} />}
                  <div className="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                    <input type="number" min="1" placeholder="1" value={saleQty} onChange={(e) => setSaleQty(e.target.value)} />
                  </div>
                  <div className="form-group">
                    <label>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (‚Ç¨)</label>
                    <input type="number" min="0" step="0.01" placeholder="0.00" value={salePrice} onChange={(e) => setSalePrice(e.target.value)} />
                  </div>
                  <div className="form-group">
                    <label>–î–∞—Ç–∞</label>
                    <input type="date" value={saleDate} onChange={(e) => setSaleDate(e.target.value)} />
                  </div>
                  <div className="form-group">
                    <label>–ó–∞–º–µ—Ç–∫–∏</label>
                    <textarea placeholder="–ì–¥–µ –ø—Ä–æ–¥–∞–ª, –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è..." value={saleNotes} onChange={(e) => setSaleNotes(e.target.value)} rows={2} />
                  </div>
                  {saleQty && salePrice && (
                    <div className={`summary-box ${Number(saleQty) * (Number(salePrice) - Number(quickSalePurchasePrice)) < 0 ? 'negative' : ''}`}>
                      <p style={{ margin: 0, fontSize: '14px' }}>
                        –ü—Ä–∏–±—ã–ª—å: <strong style={{ color: Number(saleQty) * (Number(salePrice) - Number(quickSalePurchasePrice)) >= 0 ? '#059669' : '#dc2626' }}>
                          {Number(saleQty) * (Number(salePrice) - Number(quickSalePurchasePrice)) >= 0 ? '+' : ''}{formatCurrency(Number(saleQty) * (Number(salePrice) - Number(quickSalePurchasePrice)))}
                        </strong>
                      </p>
                    </div>
                  )}
                  <div style={{ display: 'flex', gap: '8px', marginTop: '8px' }}>
                    <button className="btn btn-secondary" style={{ flex: 1 }} onClick={addQuickSale} disabled={!saleQty || !salePrice}>–ü—Ä–æ–¥–∞—Ç—å</button>
                    <button className="btn" style={{ background: '#6b7280', color: 'white' }} onClick={() => setShowQuickSale(false)}>–û—Ç–º–µ–Ω–∞</button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showPreview && (
            <div className="preview-modal" onClick={() => setShowPreview(false)}>
              <img src={previewPhoto} alt="Preview" onClick={(e) => e.stopPropagation()} />
              <button className="modal-close-btn" onClick={() => setShowPreview(false)}>‚úï</button>
            </div>
          )}

          <footer style={{ background: 'var(--bg-secondary)', borderTop: '1px solid var(--border-color)', marginTop: '48px' }}>
            <div style={{ maxWidth: '1280px', margin: '0 auto', padding: '16px 24px', textAlign: 'center' }}>
              <p style={{ fontSize: '14px', color: 'var(--text-secondary)', margin: 0 }}>–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</p>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
